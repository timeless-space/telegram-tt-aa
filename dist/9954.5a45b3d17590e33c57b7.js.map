{"version":3,"file":"9954.5a45b3d17590e33c57b7.js","mappings":"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CxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,KAAQ,MAAQ,KAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,KAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,KACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,KAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,GAAQ,KAAQ,GAAQ,KAAQ,GAAQ,KACxF,GAAQ,KAAQ,GAAQ,KAAQ,GAAQ,KAAQ,GAAQ,KAAQ,GAAQ,KAAQ,GAAQ,KACxF,GAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,QAG7DC,GAAgB,CAC3B,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GACvC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5C,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5C,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5C,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACpD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACvD,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,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","sources":["webpack://telegram-t/./src/lib/secret-sauce/utils.ts","webpack://telegram-t/./src/lib/secret-sauce/parseSdp.ts","webpack://telegram-t/./src/lib/secret-sauce/buildSdp.ts","webpack://telegram-t/./src/lib/secret-sauce/blacksilence.ts","webpack://telegram-t/./src/lib/secret-sauce/secretsauce.ts","webpack://telegram-t/./src/lib/secret-sauce/p2p.ts","webpack://telegram-t/./src/global/actions/api/calls.async.ts","webpack://telegram-t/./src/util/phoneCallEmojiConstants.ts","webpack://telegram-t/./src/global/actions/apiUpdaters/calls.async.ts","webpack://telegram-t/./src/util/vibrate.ts","webpack://telegram-t/./src/components/calls/group/MicrophoneButton.module.scss?3a9a","webpack://telegram-t/./src/components/calls/group/MicrophoneButton.tsx","webpack://telegram-t/./src/components/calls/group/helpers/formatGroupCallVolume.ts","webpack://telegram-t/./src/components/calls/group/OutlinedMicrophoneIcon.tsx","webpack://telegram-t/./src/components/calls/group/GroupCallParticipantMenu.tsx","webpack://telegram-t/./src/hooks/useRunThrottled.ts","webpack://telegram-t/./src/components/calls/group/GroupCallParticipant.module.scss?2375","webpack://telegram-t/./src/components/calls/group/GroupCallParticipant.tsx","webpack://telegram-t/./src/components/calls/group/GroupCallParticipantList.tsx","webpack://telegram-t/./src/components/calls/group/GroupCallParticipantList.module.scss?6462","webpack://telegram-t/./src/components/calls/group/GroupCallParticipantVideo.module.scss?799e","webpack://telegram-t/./src/components/calls/group/GroupCallParticipantVideo.tsx","webpack://telegram-t/./src/components/calls/group/GroupCall.module.scss?4417","webpack://telegram-t/./src/components/calls/group/GroupCall.tsx","webpack://telegram-t/./src/components/calls/group/hooks/useGroupCallVideoLayout.ts","webpack://telegram-t/./src/components/calls/ActiveCallHeader.tsx","webpack://telegram-t/./src/components/calls/phone/PhoneCallButton.module.scss?9dea","webpack://telegram-t/./src/components/calls/phone/PhoneCallButton.tsx","webpack://telegram-t/./src/components/calls/phone/PhoneCall.module.scss?a250","webpack://telegram-t/./src/components/calls/phone/PhoneCall.tsx","webpack://telegram-t/./src/components/calls/phone/RatePhoneCallModal.module.scss?64f6","webpack://telegram-t/./src/components/calls/phone/RatePhoneCallModal.tsx","webpack://telegram-t/./src/bundles/calls.ts"],"sourcesContent":["import type { P2PPayloadType } from './p2pMessage';\nimport type { PayloadType } from './types';\n\n/// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n/// unsign => sign\nexport function toTelegramSource(source: number) {\n  // eslint-disable-next-line no-bitwise\n  return source << 0;\n}\n\n/// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n/// sign => unsign\nexport function fromTelegramSource(source: number) {\n  // eslint-disable-next-line no-bitwise\n  return source >>> 0;\n}\n\nexport function getAmplitude(array: Uint8Array, scale = 3) {\n  if (!array) return 0;\n\n  const { length } = array;\n  let total = 0;\n  for (let i = 0; i < length; i++) {\n    total += array[i] * array[i];\n  }\n  const rms = Math.sqrt(total / length) / 255;\n\n  return Math.min(1, rms * scale);\n}\n\nexport function p2pPayloadTypeToConference(p: P2PPayloadType): PayloadType {\n  return {\n    id: p.id,\n    name: p.name,\n    'rtcp-fbs': p.feedbackTypes,\n    clockrate: p.clockrate,\n    parameters: p.parameters,\n    channels: p.channels,\n  };\n}\n\nexport function isRelayAddress(candidate: string) {\n  const parts = candidate.split(' ');\n  return parts.some((part) => part === 'relay');\n}\n\nexport function removeRelatedAddress(candidate: string) {\n  const parts = candidate.split(' ');\n\n  const raddrIndex = parts.indexOf('raddr');\n  if (raddrIndex !== -1) {\n    parts.splice(raddrIndex, 2);\n  }\n\n  const rportIndex = parts.indexOf('rport');\n  if (rportIndex !== -1) {\n    parts.splice(rportIndex, 2);\n  }\n\n  return parts.join(' ');\n}\n\nexport const THRESHOLD = 0.1;\n\nexport const IS_SCREENSHARE_SUPPORTED = 'getDisplayMedia' in (navigator?.mediaDevices || {});\nexport const IS_ECHO_CANCELLATION_SUPPORTED = navigator?.mediaDevices?.getSupportedConstraints().echoCancellation;\n// @ts-ignore\nexport const IS_NOISE_SUPPRESSION_SUPPORTED = navigator?.mediaDevices?.getSupportedConstraints().noiseSuppression;\n","import { toTelegramSource } from './utils';\nimport type { JoinGroupCallPayload, SsrcGroup } from './types';\n\nexport default (sessionDescription: RTCSessionDescriptionInit, isP2p = false): JoinGroupCallPayload => {\n  if (!sessionDescription || !sessionDescription.sdp) {\n    throw Error('Failed parsing SDP: session description is null');\n  }\n\n  const sections = sessionDescription\n    .sdp\n    .split('\\r\\nm=')\n    .map((s, i) => (i === 0 ? s : `m=${s}`))\n    .reduce((acc: Record<string, string[]>, el) => {\n      const name = el.match(/^m=(.+?)\\s/)?.[1] || 'header';\n      acc[acc.hasOwnProperty(name) && name === 'video' ? 'screencast' : name] = el.split('\\r\\n').filter(Boolean);\n      return acc;\n    }, {});\n\n  const lookup = (prefix: string, sectionName?: string) => {\n    if (!sectionName) {\n      return Object.values(sections).map((section) => {\n        return section.find((line) => line.startsWith(prefix))?.substr(prefix.length);\n      }).filter(Boolean)[0];\n    } else {\n      return sections[sectionName]?.find((line) => line.startsWith(prefix))?.substr(prefix.length);\n    }\n  };\n\n  const parseExtmaps = (sectionName: string) => {\n    return sections[sectionName].filter((l) => l.startsWith('a=extmap')).map((l) => {\n      const [, id, uri] = l.match(/extmap:(\\d+)(?:\\/.+)?\\s(.+)/)!;\n      return { id: Number(id), uri };\n    });\n  };\n\n  const parsePayloadTypes = (sectionName: string) => {\n    const payloads = sections[sectionName].filter((l) => l.startsWith('a=rtpmap')).map((l) => {\n      const [, id, data] = l.match(/:(\\d+)\\s(.+)/) || [];\n      const [name, clockrate, channels] = data.split('/');\n      return {\n        id: Number(id), name, clockrate: Number(clockrate), ...(channels && { channels: Number(channels) }),\n      };\n    });\n\n    const fbParams = sections[sectionName].filter((l) => l.startsWith('a=rtcp-fb')).map((l) => {\n      const [, id, data] = l.match(/:(\\d+)\\s(.+)/) || [];\n      const [type, subtype] = data.split(' ');\n      return { id: Number(id), type, subtype: subtype || '' };\n    });\n\n    const parameters = sections[sectionName].filter((l) => l.startsWith('a=fmtp')).map((l) => {\n      const [, id, data] = l.match(/:(\\d+)\\s(.+)/) || [];\n      const d = data.split(';').reduce((acc: Record<string, string>, q) => {\n        const [name, value] = q.split('=');\n        acc[name] = value;\n        return acc;\n      }, {});\n      if (Object.values(d).some((z) => !z)) return undefined;\n      return { id: Number(id), data: d };\n    }).filter(Boolean);\n\n    return payloads.map((payload) => {\n      const p = parameters.filter((l) => l!.id === payload.id).map((q) => q!.data).reduce((acc, el) => {\n        return Object.assign(acc, el);\n      }, {});\n      const f = fbParams.filter((l) => l.id === payload.id).map((l) => {\n        return {\n          type: l.type,\n          subtype: l.subtype,\n        };\n      });\n\n      return {\n        ...payload,\n        ...(Object.keys(p).length > 0 && { parameters: p }),\n        ...(f.length > 0 && { feedbackTypes: f }),\n      };\n    });\n  };\n\n  const rawSource = lookup('a=ssrc:', 'audio');\n  const sourceAudio = rawSource && Number(rawSource.split(' ')[0]);\n\n  // TODO multiple source groups\n  const rawSourceVideo = lookup('a=ssrc-group:', 'video')?.split(' ') || undefined;\n  const rawSourceScreencast = lookup('a=ssrc-group:', 'screencast')?.split(' ') || undefined;\n\n  if (!rawSourceVideo) {\n    throw Error('Failed parsing SDP: no video ssrc');\n  }\n\n  const [hash, fingerprint] = lookup('a=fingerprint:')?.split(' ') || [];\n\n  const setup = lookup('a=setup:');\n  if (!hash || !fingerprint) {\n    throw Error('Failed parsing SDP: no fingerprint');\n  }\n\n  console.log(sections);\n\n  const ufrag = lookup('a=ice-ufrag:');\n  const pwd = lookup('a=ice-pwd:');\n\n  if (!ufrag || !pwd) {\n    throw Error('Failed parsing SDP: no ICE ufrag or pwd');\n  }\n\n  return {\n    fingerprints: [\n      {\n        fingerprint,\n        hash,\n        setup: isP2p ? setup! : 'active',\n      },\n    ],\n    pwd,\n    ufrag,\n    ...(sourceAudio && { ssrc: toTelegramSource(sourceAudio) }),\n    ...(rawSourceVideo && {\n      'ssrc-groups': [\n        {\n          semantics: rawSourceVideo[0],\n          sources: rawSourceVideo.slice(1, rawSourceVideo.length).map(Number).map(toTelegramSource),\n        },\n        (isP2p && rawSourceScreencast && {\n          semantics: rawSourceScreencast[0],\n          sources: rawSourceScreencast.slice(1, rawSourceScreencast.length).map(Number).map(toTelegramSource),\n        }),\n      ].filter(Boolean) as SsrcGroup[],\n    }),\n    ...(isP2p && {\n      audioExtmap: parseExtmaps('audio'),\n      videoExtmap: parseExtmaps('video'),\n      screencastExtmap: parseExtmaps('screencast'),\n      audioPayloadTypes: parsePayloadTypes('audio'),\n      videoPayloadTypes: parsePayloadTypes('video'),\n      screencastPayloadTypes: parsePayloadTypes('screencast'),\n    }),\n  };\n};\n","import type {\n  Candidate, GroupCallTransport, PayloadType, RTPExtension, SsrcGroup,\n} from './types';\nimport { fromTelegramSource } from './utils';\n\nexport type Conference = {\n  sessionId: number;\n  audioExtensions: RTPExtension[];\n  videoExtensions: RTPExtension[];\n  audioPayloadTypes: PayloadType[];\n  videoPayloadTypes: PayloadType[];\n  ssrcs: Ssrc[];\n  transport: GroupCallTransport;\n};\n\nexport type Ssrc = {\n  userId: string;\n  endpoint: string;\n  mid: string;\n  isMain: boolean;\n  isRemoved?: boolean;\n  isVideo: boolean;\n  isPresentation?: boolean;\n  sourceGroups: SsrcGroup[];\n};\n\nexport default (conference: Conference, isAnswer = false, isPresentation = false, isP2p = false) => {\n  const lines: string[] = [];\n\n  const add = (value: string) => {\n    lines.push(value);\n  };\n\n  const {\n    sessionId,\n    ssrcs,\n    audioExtensions,\n    videoExtensions,\n    audioPayloadTypes,\n    videoPayloadTypes,\n    transport: {\n      ufrag,\n      pwd,\n      fingerprints,\n      candidates,\n    },\n  } = conference;\n\n  // Header\n  add('v=0'); // version\n  add(`o=- ${sessionId} 2 IN IP4 0.0.0.0`); // sessionId, 2=sessionVersion\n  add('s=-'); // name of the session\n  add('t=0 0'); // time when session is valid\n  add('a=ice-options:trickle');\n  add('a=msid-semantic:WMS *');\n  add(`a=group:BUNDLE ${ssrcs.map((ssrc) => ssrc.mid).join(' ')}${isPresentation ? '' : ` ${isP2p ? '3' : '2'}`}`);\n  // ice-lite: is a minimal version of the ICE specification, intended only for servers running on a public IP address\n  if (!isP2p) add('a=ice-lite');\n\n  const addCandidate = (c: Candidate) => {\n    if (c.sdpString) {\n      add(`a=${c.sdpString}`);\n    } else {\n      let str = '';\n      str += 'a=candidate:';\n      str += `${c.foundation} ${c.component} ${c.protocol} ${c.priority} ${c.ip} ${c.port} typ ${c.type}`;\n      if ('rel-addr' in c) {\n        str += ` raddr ${c['rel-addr']} rport ${c['rel-port']}`;\n      }\n      str += ` generation ${c.generation}`;\n      add(str);\n    }\n  };\n\n  const addTransport = () => {\n    add(`a=ice-ufrag:${ufrag}`);\n    add(`a=ice-pwd:${pwd}`);\n    fingerprints.forEach((fingerprint) => {\n      add(`a=fingerprint:${fingerprint.hash} ${fingerprint.fingerprint}`);\n      add(`a=setup:${isP2p ? (fingerprint.setup) : 'passive'}`);\n    });\n\n    candidates.forEach(addCandidate);\n  };\n\n  const addPayloadType = (payloadType: PayloadType) => {\n    const {\n      channels, id, name, clockrate, parameters,\n    } = payloadType;\n\n    const channelsString = channels ? `/${channels}` : '';\n    add(`a=rtpmap:${id} ${name}/${clockrate}${channelsString}`);\n\n    if (parameters) {\n      const parametersString = Object.keys(parameters).map((key) => {\n        return `${key}=${parameters![key]};`;\n      }).join(' ');\n\n      add(`a=fmtp:${id} ${parametersString}`);\n    }\n\n    payloadType['rtcp-fbs']?.forEach((fbParam) => {\n      add(`a=rtcp-fb:${id} ${fbParam.type}${fbParam.subtype ? ` ${fbParam.subtype}` : ''}`);\n    });\n  };\n\n  const addSsrcEntry = (entry: Ssrc) => {\n    const payloadTypes = entry.isVideo ? videoPayloadTypes : audioPayloadTypes;\n\n    const type = entry.isVideo ? 'video' : 'audio';\n    add(`m=${type} ${entry.isMain ? 1 : 0} RTP/SAVPF ${payloadTypes.map((l) => l.id).join(' ')}`);\n    add('c=IN IP4 0.0.0.0');\n    add('b=AS:1300'); // 1300000 / 1000\n    add(`a=mid:${entry.mid}`);\n    add('a=rtcp-mux');\n    payloadTypes.forEach(addPayloadType);\n\n    add('a=rtcp:1 IN IP4 0.0.0.0');\n    if (entry.isVideo) {\n      add('a=rtcp-rsize');\n    }\n\n    (entry.isVideo ? videoExtensions : audioExtensions).forEach(({ id, uri }) => {\n      add(`a=extmap:${id} ${uri}`);\n    });\n\n    if (entry.isRemoved) {\n      add('a=inactive');\n      return;\n    }\n\n    addTransport();\n\n    if (isP2p) {\n      add('a=sendrecv');\n      add('a=bundle-only');\n    } else {\n      if (isAnswer) {\n        add('a=recvonly');\n        return;\n      }\n      if (entry.isMain) {\n        add('a=sendrecv');\n      } else {\n        add('a=sendonly');\n        add('a=bundle-only');\n      }\n    }\n\n    entry.sourceGroups.forEach((sourceGroup) => {\n      add(`a=ssrc-group:${sourceGroup.semantics} ${sourceGroup.sources.map(fromTelegramSource).join(' ')}`);\n      sourceGroup.sources.forEach((ssrcTelegram) => {\n        const ssrc = fromTelegramSource(ssrcTelegram);\n        add(`a=ssrc:${ssrc} cname:${entry.endpoint}`);\n        add(`a=ssrc:${ssrc} msid:${entry.endpoint} ${entry.endpoint}`);\n        add(`a=ssrc:${ssrc} mslabel:${entry.endpoint}`);\n        add(`a=ssrc:${ssrc} label:${entry.endpoint}`);\n      });\n    });\n  };\n\n  if (!isP2p) {\n    ssrcs.filter((ssrc) => ssrc.mid === '0' || ssrc.mid === '1').map(addSsrcEntry);\n  } else {\n    ssrcs.filter(addSsrcEntry);\n  }\n\n  if (!isPresentation) {\n    add('m=application 1 UDP/DTLS/SCTP webrtc-datachannel');\n    add('c=IN IP4 0.0.0.0');\n    addTransport();\n    add('a=ice-options:trickle');\n    add(`a=mid:${isP2p ? '3' : (isPresentation ? '1' : '2')}`);\n    add('a=sctp-port:5000');\n    add('a=max-message-size:262144');\n  }\n\n  if (!isP2p) {\n    ssrcs.filter((ssrc) => ssrc.mid !== '0' && ssrc.mid !== '1').map(addSsrcEntry);\n  }\n\n  return `${lines.join('\\n')}\\n`;\n};\n","// https://blog.mozilla.org/webrtc/warm-up-with-replacetrack/\n\nexport const silence = (ctx: AudioContext) => {\n  const oscillator = ctx.createOscillator();\n  const dst = oscillator.connect(ctx.createMediaStreamDestination());\n  oscillator.start();\n  return new MediaStream([Object.assign((dst as any).stream.getAudioTracks()[0], { enabled: false })]);\n};\n\nexport const black = ({ width = 640, height = 480 } = {}) => {\n  const canvas = Object.assign(document.createElement('canvas'), { width, height });\n  const ctx = canvas.getContext('2d');\n  if (!ctx) throw Error('Cannot create canvas ctx');\n\n  ctx.fillRect(0, 0, width, height);\n  const stream = canvas.captureStream();\n  return new MediaStream([Object.assign(stream.getVideoTracks()[0], { enabled: false })]);\n};\n","import parseSdp from './parseSdp';\nimport { ColibriClass } from './colibriClass';\nimport type {\n  GroupCallConnectionData, GroupCallConnectionState, GroupCallParticipant, JoinGroupCallPayload,\n} from './types';\nimport buildSdp, { Conference, Ssrc } from './buildSdp';\nimport { black, silence } from './blacksilence';\nimport {\n  getAmplitude,\n  IS_ECHO_CANCELLATION_SUPPORTED,\n  IS_NOISE_SUPPRESSION_SUPPORTED,\n  THRESHOLD,\n} from './utils';\nimport Deferred from \"../../util/Deferred\";\nimport safePlay from \"../../util/safePlay\";\n\nexport type StreamType = 'audio' | 'video' | 'presentation';\nconst DEFAULT_MID = 3;\ntype GroupCallState = {\n  connection?: RTCPeerConnection;\n  screenshareConnection?: RTCPeerConnection;\n  dataChannel?: RTCDataChannel;\n  screenshareDataChannel?: RTCDataChannel;\n  participants?: GroupCallParticipant[];\n  conference?: Partial<Conference>;\n  screenshareConference?: Partial<Conference>;\n  streams?: Record<string, {\n    audio?: MediaStream;\n    video?: MediaStream;\n    presentation?: MediaStream;\n  }>;\n  participantFunctions?: Record<string, {\n    setVolume?: (volume: number) => void;\n    toggleMute?: (muted: boolean) => void;\n    getCurrentAmplitude?: () => number;\n  }>;\n  onUpdate?: (...args: any[]) => void;\n  myId?: string;\n  black?: MediaStream;\n  silence?: MediaStream;\n  updatingParticipantsQueue?: any[];\n  facingMode?: VideoFacingModeEnum;\n  isSpeakerDisabled?: boolean;\n  analyserInterval?: number;\n  speaking?: Record<string, number>;\n  audioElement?: HTMLAudioElement;\n  destination?: MediaStreamAudioDestinationNode;\n  audioContext?: AudioContext;\n  mediaStream?: MediaStream;\n  lastMid: number;\n  audioStream?: MediaStream;\n  audioSource?: MediaStreamAudioSourceNode;\n  audioAnalyser?: AnalyserNode;\n};\n\nlet state: GroupCallState | undefined;\n\nexport async function getDevices(streamType: StreamType, isInput = true) {\n  return (await navigator.mediaDevices.enumerateDevices())\n    .filter((l) => l.kind === `${streamType}${isInput ? 'input' : 'output'}`);\n}\n\nexport function toggleSpeaker() {\n  if (!state) {\n    return;\n  }\n\n  state.isSpeakerDisabled = !state.isSpeakerDisabled;\n  state?.onUpdate?.({\n    '@type': 'updateGroupCallConnectionState',\n    connectionState: 'connected',\n    isSpeakerDisabled: state.isSpeakerDisabled,\n  });\n  if (state.participantFunctions) {\n    Object.values(state.participantFunctions).forEach((l) => {\n      l.toggleMute?.(!!state?.isSpeakerDisabled);\n    });\n  }\n}\n\nfunction leavePresentation(isFromToggle?: boolean) {\n  if (!state) {\n    return;\n  }\n  state.screenshareDataChannel?.close();\n  state.screenshareConnection?.close();\n\n  if (!isFromToggle) {\n    state.onUpdate?.({\n      '@type': 'updateGroupCallLeavePresentation',\n    });\n  }\n}\n\nexport function toggleNoiseSuppression() {\n  if (!state || !state.myId || !state.streams) {\n    return;\n  }\n\n  const audioStream = state.streams[state.myId].audio;\n  if (!audioStream) {\n    return;\n  }\n\n  const track = audioStream.getTracks()[0];\n\n  if (!track) {\n    return;\n  }\n\n  // @ts-ignore\n  const { echoCancellation, noiseSuppression } = track.getConstraints();\n\n  track.applyConstraints({\n    echoCancellation: !echoCancellation,\n    // @ts-ignore\n    noiseSuppression: !noiseSuppression,\n  });\n}\n\nexport function getUserStreams(userId: string) {\n  return state?.streams?.[userId];\n}\n\nexport function setVolume(userId: string, volume: number) {\n  const participantFunctions = state?.participantFunctions?.[userId];\n  if (!participantFunctions) return;\n  participantFunctions.setVolume?.(volume);\n}\n\nexport function isStreamEnabled(streamType: StreamType, userId?: string) {\n  const id = userId || state?.myId;\n  const stream = id && getUserStreams(id)?.[streamType];\n  if (!stream) return false;\n\n  return stream.getTracks()[0]?.enabled;\n}\n\nfunction updateGroupCallStreams(userId: string) {\n  state?.onUpdate?.({\n    '@type': 'updateGroupCallStreams',\n    userId,\n    hasAudioStream: isStreamEnabled('audio', userId),\n    hasVideoStream: isStreamEnabled('video', userId),\n    hasPresentationStream: isStreamEnabled('presentation', userId),\n    amplitude: state.speaking?.[userId],\n  });\n}\n\nasync function getUserStream(streamType: StreamType, facing: VideoFacingModeEnum = 'user') {\n  if (streamType === 'audio' && state?.audioStream) {\n    return state.audioStream;\n  }\n\n  if (streamType === 'presentation') {\n    return (navigator.mediaDevices as any).getDisplayMedia({\n      audio: false,\n      video: true,\n    });\n  }\n\n  const media = await navigator.mediaDevices.getUserMedia({\n    audio: streamType === 'audio' ? {\n      // @ts-ignore\n      ...(IS_ECHO_CANCELLATION_SUPPORTED && {echoCancellation: true}),\n      ...(IS_NOISE_SUPPRESSION_SUPPORTED && {noiseSuppression: true}),\n    } : false,\n    video: streamType === 'video' ? {\n      facingMode: facing,\n    } : false,\n  });\n\n  if (state && streamType === 'audio') {\n    state.audioStream = media;\n  }\n\n  if (streamType === 'video') {\n    const vid = document.createElement('video');\n    vid.srcObject = media;\n\n    const deferred = new Deferred();\n    vid.oncanplay = () => deferred.resolve();\n    await deferred.promise;\n  }\n\n  return media;\n}\n\nexport async function switchCameraInput() {\n  if (!state?.myId || !state.connection || !state.streams || !state.facingMode) {\n    return;\n  }\n\n  const stream = getUserStreams(state.myId)?.video;\n\n  if (!stream) return;\n\n  const track = stream.getTracks()[0];\n\n  if (!track) {\n    return;\n  }\n\n  const sender = state.connection.getSenders().find((l) => track.id === l.track?.id);\n\n  if (!sender) {\n    return;\n  }\n\n  state.facingMode = state.facingMode === 'environment' ? 'user' : 'environment';\n  try {\n    const newStream = await getUserStream('video', state.facingMode);\n\n    await sender.replaceTrack(newStream.getTracks()[0]);\n    state.streams[state.myId].video = newStream;\n  } catch (e) {\n\n  }\n}\n\nexport async function toggleStream(streamType: StreamType, value: boolean | undefined = undefined) {\n  if (!state || !state.myId || !state.connection || !state.streams) {\n    return;\n  }\n\n  const stream = getUserStreams(state.myId)?.[streamType];\n  if (!stream) return;\n\n  const track = stream.getTracks()[0];\n\n  if (!track) {\n    return;\n  }\n\n  const sender = [\n    ...state.connection.getSenders(),\n    ...(state.screenshareConnection?.getSenders() || []),\n  ].find((l) => track.id === l.track?.id);\n\n  if (!sender) {\n    return;\n  }\n\n  value = value === undefined ? !track.enabled : value;\n\n  try {\n    if (value && !track.enabled) {\n      const newStream = await getUserStream(streamType);\n      await sender.replaceTrack(newStream.getTracks()[0]);\n      state.streams[state.myId][streamType] = newStream;\n      if (streamType === 'video') {\n        state.facingMode = 'user';\n      } else if (streamType === 'audio') {\n        const { audioContext } = state;\n        if (!audioContext) return;\n        const source = state.audioSource || audioContext.createMediaStreamSource(newStream);\n\n        const analyser = state.audioAnalyser || audioContext.createAnalyser();\n        analyser.minDecibels = -100;\n        analyser.maxDecibels = -30;\n        analyser.smoothingTimeConstant = 0.05;\n        analyser.fftSize = 1024;\n\n        source.connect(analyser);\n\n        state = {\n          ...state,\n          audioSource: source,\n          audioAnalyser: analyser,\n          participantFunctions: {\n            ...state.participantFunctions,\n            [state.myId]: {\n              ...state.participantFunctions?.[state.myId],\n              getCurrentAmplitude: () => {\n                const array = new Uint8Array(analyser.frequencyBinCount);\n                analyser.getByteFrequencyData(array);\n                return getAmplitude(array, 1.5);\n              },\n            },\n          },\n        };\n      }\n    } else if (!value && track.enabled) {\n      const newStream = streamType === 'audio' ? state.silence : state.black;\n      if (!newStream) return;\n\n      await sender.replaceTrack(newStream.getTracks()[0]);\n      state.streams[state.myId][streamType] = newStream;\n      if (streamType === 'video') {\n        state.facingMode = undefined;\n      }\n\n      if(streamType !== 'audio') {\n        // We only want to stop video streams\n        track.stop();\n      } else {\n        state.audioSource?.disconnect();\n        state.audioAnalyser?.disconnect();\n      }\n    }\n    updateGroupCallStreams(state.myId!);\n    if (streamType === 'presentation' && !value) leavePresentation(true);\n  } catch (e) {\n\n  }\n}\n\nfunction updateConnectionState(connectionState: GroupCallConnectionState) {\n  state?.onUpdate?.({\n    '@type': 'updateGroupCallConnectionState',\n    connectionState,\n  });\n}\n\nexport function leaveGroupCall() {\n  if (!state) {\n    return;\n  }\n\n  if (state.myId && state.streams?.[state.myId]) {\n    Object.values(state.streams[state.myId] || {}).forEach((stream) => {\n      stream?.getTracks().forEach((track) => {\n        track.stop();\n      });\n    });\n  }\n\n  state.audioStream?.getTracks().forEach((track) => {\n    track.stop();\n  });\n  leavePresentation(true);\n  state.dataChannel?.close();\n  state.connection?.close();\n  updateConnectionState('disconnected');\n\n  if (state.analyserInterval) {\n    clearInterval(state.analyserInterval);\n  }\n\n  state = undefined;\n}\n\nfunction analyzeAmplitudes() {\n  if (!state || !state.participantFunctions) return;\n\n  Object.keys(state.participantFunctions).forEach((id) => {\n    const { getCurrentAmplitude } = state!.participantFunctions![Number(id)];\n\n    if (getCurrentAmplitude) {\n      const amplitude = getCurrentAmplitude();\n      const prevAmplitude = state!.speaking![id] || 0;\n      state!.speaking![id] = amplitude;\n      if ((amplitude > THRESHOLD && prevAmplitude <= THRESHOLD)\n        || (amplitude <= THRESHOLD && prevAmplitude > THRESHOLD)) {\n        updateGroupCallStreams(id);\n      }\n    }\n  });\n}\n\nfunction createDataChannel(connection: RTCPeerConnection) {\n  const dataChannel = connection.createDataChannel('data', {\n    id: 0,\n  });\n\n  dataChannel.onopen = () => {\n    // console.log('Data channel open!');\n  };\n\n  dataChannel.onmessage = (e) => {\n    // console.log('onmessage');\n    const data = JSON.parse(e.data) as ColibriClass;\n    // console.log(data);\n    switch (data.colibriClass) {\n      case 'DominantSpeakerEndpointChangeEvent':\n        break;\n      case 'SenderVideoConstraints':\n\n        break;\n      case 'EndpointConnectivityStatusChangeEvent':\n\n        break;\n    }\n  };\n\n  dataChannel.onerror = (e) => {\n    console.log('%conerror', 'background: green; font-size: 5em');\n    console.error(e);\n  };\n\n  return dataChannel;\n}\n\nexport async function handleUpdateGroupCallParticipants(updatedParticipants: GroupCallParticipant[]) {\n  if (!state) {\n    return;\n  }\n\n  const {\n    participants, conference, connection, myId,\n  } = state;\n\n  if (!participants || !conference || !connection || !conference.ssrcs || !conference.transport || !myId) {\n    return;\n  }\n\n  // Joined from another client\n  if (updatedParticipants.find((participant) => {\n    return participant.isSelf\n      && participant.source\n      !== state?.conference?.ssrcs?.find((l) => l.isMain && !l.isVideo)?.sourceGroups[0].sources[0];\n  })) {\n    leaveGroupCall();\n    return;\n  }\n\n  const newEndpoints: string[] = [];\n  updatedParticipants.forEach((participant) => {\n    if (participant.isSelf) {\n      if (participant.isMuted && !participant.canSelfUnmute) {\n        // Muted by admin\n        toggleStream('audio', false);\n        toggleStream('video', false);\n        toggleStream('presentation', false);\n      }\n      return;\n    }\n\n    const { isLeft } = participant;\n    const isAudioLeft = participant.isMuted || participant.isMutedByMe;\n    const isVideoLeft = !participant.isVideoJoined || !participant.video || isLeft;\n    const isPresentationLeft = !participant.presentation || isLeft;\n\n    let hasVideo = false;\n    let hasAudio = false;\n    let hasPresentation = false;\n\n    conference.ssrcs!.filter((l) => l.userId === participant.id).forEach((ssrc) => {\n      if (!ssrc.isVideo) {\n        if (ssrc.sourceGroups[0].sources[0] === participant.source) {\n          hasAudio = true;\n        }\n        // console.log('has audio, removed=', isAudioLeft);\n        ssrc.isRemoved = isAudioLeft;\n      }\n\n      if (ssrc.isVideo) {\n        if (!ssrc.isPresentation) {\n          if (!!participant.video && ssrc.endpoint === participant.video.endpoint) {\n            hasVideo = true;\n          }\n          // console.log('has video = ', hasVideo, ' removed=', isVideoLeft);\n          ssrc.isRemoved = isVideoLeft;\n        }\n\n        if (ssrc.isPresentation) {\n          if (!!participant.presentation && ssrc.endpoint === participant.presentation.endpoint) {\n            hasPresentation = true;\n          }\n          // console.log('has presentation, removed=', isPresentationLeft);\n          ssrc.isRemoved = isPresentationLeft;\n        }\n      }\n    });\n\n    if (!isAudioLeft && !hasAudio) {\n      // console.log('add audio');\n      state!.lastMid = state!.lastMid + 1;\n      conference.ssrcs!.push({\n        userId: participant.id,\n        isMain: false,\n        endpoint: `audio${participant.source}`,\n        isVideo: false,\n        sourceGroups: [{\n          semantics: 'FID',\n          sources: [participant.source],\n        }],\n        mid: state!.lastMid.toString()\n      });\n    }\n\n    if (!isVideoLeft && !hasVideo && participant.video) {\n      // console.log('add video', participant.video);\n      state!.lastMid = state!.lastMid + 1;\n\n      newEndpoints.push(participant.video.endpoint);\n      conference.ssrcs!.push({\n        userId: participant.id,\n        isMain: false,\n        endpoint: participant.video.endpoint,\n        isVideo: true,\n        sourceGroups: participant.video.sourceGroups,\n        mid: state!.lastMid.toString()\n      });\n    }\n\n    if (!isPresentationLeft && !hasPresentation && participant.presentation) {\n      // console.log('add presentation');\n      state!.lastMid = state!.lastMid + 1;\n      conference.ssrcs!.push({\n        isPresentation: true,\n        userId: participant.id,\n        isMain: false,\n        endpoint: participant.presentation.endpoint,\n        isVideo: true,\n        sourceGroups: participant.presentation.sourceGroups,\n        mid: state!.lastMid.toString()\n      });\n    }\n  });\n\n  if (state.updatingParticipantsQueue) {\n    state.updatingParticipantsQueue.push(conference);\n    return;\n  } else {\n    state.updatingParticipantsQueue = [];\n  }\n\n  const sdp = buildSdp(conference as Conference);\n  await connection.setRemoteDescription({\n    type: 'offer',\n    sdp,\n  });\n\n  try {\n    const answer = await connection.createAnswer();\n    await connection.setLocalDescription(answer);\n\n    updateGroupCallStreams(myId);\n    if (state.updatingParticipantsQueue.length > 0) {\n      // eslint-disable-next-line no-restricted-syntax\n      for (const newConference of state.updatingParticipantsQueue) {\n        await connection.setRemoteDescription({\n          type: 'offer',\n          sdp: buildSdp(newConference as Conference),\n        });\n        const answerNew = await connection.createAnswer();\n        await connection.setLocalDescription(answerNew);\n        updateGroupCallStreams(myId);\n\n        // if (newEndpoints.length > 0) {\n        //   sendDataChannelMessage({\n        //     colibriClass: 'ReceiverVideoConstraints',\n        //     defaultConstraints: {\n        //       maxHeight: 0,\n        //     },\n        //     constraints: {\n        //       ...(newEndpoints.reduce((acc: Record<string, any>, el) => {\n        //         acc[el] = {\n        //           minHeight: 0,\n        //           maxHeight: 1080,\n        //         };\n        //         return acc;\n        //       }, {})),\n        //     },\n        //     onStageEndpoints: [],\n        //   });\n        // }\n      }\n    }\n    state.updatingParticipantsQueue = undefined;\n  } catch (e) {\n    console.error(e);\n  }\n}\n//\n// function sendDataChannelMessage(message: ColibriClass) {\n//   if (!state || !state.dataChannel || state.dataChannel.readyState !== 'open') {\n//     return;\n//   }\n//\n//   // console.log('SEND!', message);\n//   state.dataChannel.send(JSON.stringify(message));\n// }\n\nexport async function handleUpdateGroupCallConnection(data: GroupCallConnectionData, isPresentation: boolean) {\n  if (!state) {\n    return;\n  }\n\n  const conference = isPresentation ? state.screenshareConference : state.conference;\n  const connection = isPresentation ? state.screenshareConnection : state.connection;\n\n  if (!conference || !connection || !conference.ssrcs) {\n    return;\n  }\n\n  const sessionId = Date.now();\n  const newConference = {\n    ...conference,\n    transport: data.transport,\n    sessionId,\n    audioExtensions: data.audio?.['rtp-hdrexts'],\n    audioPayloadTypes: data.audio?.['payload-types'],\n    videoExtensions: data.video?.['rtp-hdrexts'],\n    videoPayloadTypes: data.video?.['payload-types'],\n  } as Conference;\n\n  state = {\n    ...state,\n    ...(!isPresentation ? { conference: newConference } : { screenshareConference: newConference }),\n  };\n\n  try {\n    await connection.setRemoteDescription({\n      type: 'answer',\n      sdp: buildSdp(newConference, true, isPresentation),\n    });\n\n    // state.resolveTest();\n    // state.test = true;\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nfunction handleTrack(e: RTCTrackEvent) {\n  if (!state || !state.audioElement || !state.audioContext || !state.mediaStream) {\n    return;\n  }\n  const ssrc = state.conference?.ssrcs?.find((l) => l.endpoint === e.track.id);\n  if (!ssrc || !ssrc.userId) {\n    return;\n  }\n\n  const { userId, isPresentation } = ssrc;\n  const participant = state.participants?.find((p) => p.id === userId);\n\n  const streamType = (e.track.kind === 'video' ? (isPresentation ? 'presentation' : 'video') : 'audio') as StreamType;\n\n  e.track.onended = () => {\n    delete state?.streams?.[userId][streamType];\n    updateGroupCallStreams(userId);\n  };\n\n  const stream = e.streams[0];\n\n  if (e.track.kind === 'audio') {\n    const { mediaStream } = state;\n    const audioContext = new (window.AudioContext)();\n    const source = audioContext.createMediaStreamSource(stream);\n\n    const gainNode = audioContext.createGain();\n    gainNode.gain.value = (participant?.volume || 10000) / 10000;\n\n    const muteNode = audioContext.createGain();\n    gainNode.gain.value = 1;\n\n    const analyser = audioContext.createAnalyser();\n    analyser.minDecibels = -100;\n    analyser.maxDecibels = -30;\n    analyser.smoothingTimeConstant = 0.05;\n    analyser.fftSize = 1024;\n\n    source.connect(analyser).connect(muteNode).connect(gainNode).connect(audioContext.destination);\n\n    mediaStream!.addTrack(source.mediaStream.getAudioTracks()[0]);\n\n    // https://stackoverflow.com/questions/41784137/webrtc-doesnt-work-with-audiocontext#comment117600018_41784241\n    const test = new Audio();\n    test.srcObject = stream;\n    // test.srcObject = source.mediaStream;\n    test.muted = true;\n    test.remove();\n\n    state = {\n      ...state,\n      participantFunctions: {\n        ...state.participantFunctions,\n        [userId]: {\n          ...state.participantFunctions?.[userId],\n          setVolume: (volume: number) => {\n            gainNode.gain.value = volume > 1 ? volume * 2 : volume;\n          },\n          toggleMute: (muted?: boolean) => {\n            muteNode.gain.value = muted ? 0 : 1;\n          },\n          getCurrentAmplitude: () => {\n            const array = new Uint8Array(analyser.frequencyBinCount);\n            analyser.getByteFrequencyData(array);\n            return getAmplitude(array, 1.5);\n          },\n        },\n      },\n    };\n  }\n\n  state = {\n    ...state,\n    streams: {\n      ...state.streams,\n      [userId]: {\n        ...state.streams?.[userId],\n        [streamType]: stream,\n      },\n    },\n  };\n\n  updateGroupCallStreams(userId);\n}\n\nfunction initializeConnection(\n  streams: MediaStream[],\n  resolve: (payload: JoinGroupCallPayload) => void,\n  isPresentation = false,\n) {\n  const connection = new RTCPeerConnection();\n\n  const dataChannel = isPresentation ? undefined : createDataChannel(connection);\n\n  streams.forEach((stream) => stream.getTracks().forEach((track) => {\n    connection.addTrack(track, stream);\n  }));\n\n  if (!isPresentation) {\n    connection.oniceconnectionstatechange = () => {\n      const connectionState = connection.iceConnectionState;\n      console.log('iceconnectionstatechange', connectionState);\n      if (connectionState === 'connected' || connectionState === 'completed') {\n        updateConnectionState('connected');\n      } else if (connectionState === 'checking' || connectionState === 'new') {\n        updateConnectionState('connecting');\n      } else if (connection.iceConnectionState === 'disconnected') {\n        updateConnectionState('reconnecting');\n      }\n    };\n  }\n  connection.onconnectionstatechange = () => {\n    console.log('connectionstatechange', connection.connectionState);\n  }\n  connection.ontrack = handleTrack;\n  connection.onnegotiationneeded = async () => {\n    if (!state) return;\n\n    console.log('onnegotiationneeded');\n\n    const { myId } = state;\n\n    if (!myId) {\n      return;\n    }\n    const offer = await connection.createOffer({\n      offerToReceiveVideo: true,\n      offerToReceiveAudio: !isPresentation,\n    });\n    console.log('offer created');\n\n    await connection.setLocalDescription(offer);\n    console.log('local desc set');\n\n    if (!offer.sdp) {\n      return;\n    }\n\n    const sdp = parseSdp(offer);\n    const audioSsrc: Ssrc | undefined = !isPresentation ? {\n      userId: '',\n      sourceGroups: [\n        {\n          semantics: 'FID',\n          sources: [sdp.ssrc || 0],\n        },\n      ],\n      isRemoved: isPresentation,\n      isMain: true,\n      isVideo: false,\n      isPresentation,\n      endpoint: isPresentation ? '1' : '0',\n      mid: isPresentation ? '1' : '0'\n    } : undefined;\n\n    const videoSsrc: Ssrc | undefined = sdp['ssrc-groups'] && {\n      isPresentation,\n      userId: '',\n      sourceGroups: sdp['ssrc-groups'],\n      isMain: true,\n      isVideo: true,\n      endpoint: isPresentation ? '0' : '1',\n      mid: isPresentation ? '0' : '1'\n    };\n\n    const conference = isPresentation ? state.screenshareConference : state.conference;\n\n    const ssrcs: Ssrc[] = [];\n    if (isPresentation) {\n      if (videoSsrc) ssrcs.push(videoSsrc);\n      if (audioSsrc) ssrcs.push(audioSsrc);\n    } else {\n      if (audioSsrc) ssrcs.push(audioSsrc);\n      if (videoSsrc) ssrcs.push(videoSsrc);\n    }\n\n    const audioStream = streams.find((l) => l.getTracks()[0].kind === 'audio');\n    const videoStream = streams.find((l) => l.getTracks()[0].kind === 'video');\n\n    state = {\n      ...state,\n      ...(!isPresentation ? {\n        conference: {\n          ...conference,\n          ssrcs,\n        },\n      } : {\n        screenshareConference: {\n          ...conference,\n          ssrcs,\n        },\n      }),\n      streams: {\n        ...state.streams,\n        [myId]: {\n          ...state.streams?.[myId],\n          ...(audioStream && { audio: audioStream }),\n          ...(!isPresentation && videoStream ? { video: videoStream } : { presentation: videoStream }),\n        },\n      },\n    };\n\n    updateGroupCallStreams(myId);\n\n    resolve(sdp);\n  };\n\n  return { connection, dataChannel };\n}\n\nexport async function startSharingScreen(): Promise<JoinGroupCallPayload | undefined> {\n  if (!state) {\n    return undefined;\n  }\n\n  try {\n    const stream: MediaStream | undefined = await getUserStream('presentation');\n\n    if (!stream) {\n      return undefined;\n    }\n\n    stream.getTracks()[0].onended = () => {\n      if (state && state.myId) {\n        delete state.streams?.[state.myId].presentation;\n        updateGroupCallStreams(state.myId);\n        leavePresentation();\n      }\n    };\n\n    return await new Promise((resolve) => {\n      const { connection, dataChannel } = initializeConnection([stream], resolve, true);\n      state = {\n        ...state!,\n        screenshareConnection: connection,\n        screenshareDataChannel: dataChannel,\n      };\n    });\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport function joinGroupCall(\n  myId: string,\n  audioContext: AudioContext,\n  audioElement: HTMLAudioElement,\n  onUpdate: (...args: any[]) => void,\n): Promise<JoinGroupCallPayload> {\n  if (state) {\n    throw Error('Already in call');\n  }\n\n  updateConnectionState('connecting');\n\n  const mediaStream = new MediaStream();\n  audioElement.srcObject = mediaStream;\n  safePlay(audioElement);\n\n  state = {\n    onUpdate,\n    participants: [],\n    myId,\n    speaking: {},\n    silence: silence(audioContext),\n    black: black({ width: 640, height: 480 }),\n    // @ts-ignore\n    analyserInterval: setInterval(analyzeAmplitudes, 1000),\n    audioElement,\n    // destination,\n    audioContext,\n    mediaStream,\n    lastMid: DEFAULT_MID,\n  };\n\n  // Prepare microphone\n  getUserStream('audio');\n\n  return new Promise((resolve) => {\n    state = {\n      ...state!,\n      ...initializeConnection([state!.silence!, state!.black!], resolve),\n    };\n  });\n}\n","import { black, silence } from './blacksilence';\nimport type { ApiPhoneCallConnection, P2pParsedSdp } from './types';\nimport parseSdp from './parseSdp';\nimport type { MediaContent, MediaStateMessage, P2pMessage } from './p2pMessage';\nimport {\n  fromTelegramSource,\n  IS_ECHO_CANCELLATION_SUPPORTED,\n  IS_NOISE_SUPPRESSION_SUPPORTED, isRelayAddress,\n  p2pPayloadTypeToConference, removeRelatedAddress,\n} from './utils';\nimport buildSdp, { Conference } from './buildSdp';\nimport { getUserStreams, StreamType } from './secretsauce';\n\ntype P2pState = {\n  connection: RTCPeerConnection;\n  dataChannel: RTCDataChannel;\n  emitSignalingData: (data: P2pMessage) => void;\n  onUpdate: (...args: any[]) => void;\n  conference?: Partial<Conference>;\n  isOutgoing: boolean;\n  candidates: string[];\n  streams: {\n    video?: MediaStream;\n    audio?: MediaStream;\n    presentation?: MediaStream;\n    ownAudio?: MediaStream;\n    ownVideo?: MediaStream;\n    ownPresentation?: MediaStream;\n  };\n  silence: MediaStream;\n  blackVideo: MediaStream;\n  blackPresentation: MediaStream;\n  mediaState: Omit<MediaStateMessage, '@type'>;\n  audio: HTMLAudioElement;\n  gotInitialSetup?: boolean;\n  facingMode?: VideoFacingModeEnum;\n};\n\nlet state: P2pState | undefined;\n\nexport function getStreams() {\n  return state?.streams;\n}\n\nfunction updateStreams() {\n  state?.onUpdate({\n    ...state.mediaState,\n    '@type': 'updatePhoneCallMediaState',\n  });\n}\n\nfunction getUserStream(streamType: StreamType, facing: VideoFacingModeEnum = 'user') {\n  if (streamType === 'presentation') {\n    return (navigator.mediaDevices as any).getDisplayMedia({\n      audio: false,\n      video: true,\n    });\n  }\n\n  return navigator.mediaDevices.getUserMedia({\n    audio: streamType === 'audio' ? {\n      // @ts-ignore\n      ...(IS_ECHO_CANCELLATION_SUPPORTED && { echoCancellation: true }),\n      ...(IS_NOISE_SUPPRESSION_SUPPORTED && { noiseSuppression: true }),\n    } : false,\n    video: streamType === 'video' ? {\n      facingMode: facing,\n    } : false,\n  });\n}\n\nexport async function switchCameraInputP2p() {\n  if (!state || !state.facingMode) {\n    return;\n  }\n\n  const stream = state.streams.ownVideo;\n\n  if (!stream) return;\n\n  const track = stream.getTracks()[0];\n\n  if (!track) {\n    return;\n  }\n\n  const sender = state.connection.getSenders().find((l) => track.id === l.track?.id);\n\n  if (!sender) {\n    return;\n  }\n\n  state.facingMode = state.facingMode === 'environment' ? 'user' : 'environment';\n  try {\n    const newStream = await getUserStream('video', state.facingMode);\n\n    await sender.replaceTrack(newStream.getTracks()[0]);\n    state.streams.ownVideo = newStream;\n    updateStreams();\n  } catch (e) {\n\n  }\n}\n\nexport async function toggleStreamP2p(streamType: StreamType, value: boolean | undefined = undefined) {\n  if (!state) return;\n  const stream = streamType === 'audio' ? state.streams.ownAudio\n    : (streamType === 'video' ? state.streams.ownVideo : state.streams.ownPresentation);\n\n  if (!stream) return;\n  const track = stream.getTracks()[0];\n\n  if (!track) {\n    return;\n  }\n\n  const sender = state.connection.getSenders().find((l) => track.id === l.track?.id);\n\n  if (!sender) {\n    return;\n  }\n\n  value = value === undefined ? !track.enabled : value;\n\n  try {\n    if (value && !track.enabled) {\n      const newStream = await getUserStream(streamType);\n      newStream.getTracks()[0].onended = () => {\n        toggleStreamP2p(streamType, false);\n      };\n      await sender.replaceTrack(newStream.getTracks()[0]);\n      if (streamType === 'audio') {\n        state.streams.ownAudio = newStream;\n      } else if (streamType === 'video') {\n        state.streams.ownVideo = newStream;\n        state.facingMode = 'user';\n      } else {\n        state.streams.ownPresentation = newStream;\n      }\n      if (streamType === 'video' || streamType === 'presentation') {\n        toggleStreamP2p(streamType === 'video' ? 'presentation' : 'video', false);\n      }\n      // if (streamType === 'video') {\n      //   state.facingMode = 'user';\n      // }\n    } else if (!value && track.enabled) {\n      track.stop();\n      const newStream = streamType === 'audio' ? state.silence\n        : (streamType === 'video' ? state.blackVideo : state.blackPresentation);\n      if (!newStream) return;\n\n      await sender.replaceTrack(newStream.getTracks()[0]);\n\n      if (streamType === 'audio') {\n        state.streams.ownAudio = newStream;\n      } else if (streamType === 'video') {\n        state.streams.ownVideo = newStream;\n      } else {\n        state.streams.ownPresentation = newStream;\n      }\n      // if (streamType === 'video') {\n      //   state.facingMode = undefined;\n      // }\n    }\n    updateStreams();\n    sendMediaState();\n  } catch (e) {\n\n  }\n}\n\nexport async function joinPhoneCall(\n  connections: ApiPhoneCallConnection[],\n  emitSignalingData: (data: P2pMessage) => void,\n  isOutgoing: boolean,\n  shouldStartVideo: boolean,\n  isP2p: boolean,\n  onUpdate: (...args: any[]) => void,\n) {\n  const conn = new RTCPeerConnection({\n    iceServers: connections.map((connection) => (\n      {\n        urls: [\n          connection.isTurn && `turn:${connection.ip}:${connection.port}`,\n          connection.isStun && `stun:${connection.ip}:${connection.port}`,\n        ].filter(Boolean) as string[],\n        username: connection.username,\n        credentialType: 'password',\n        credential: connection.password,\n      }\n    )),\n    iceCandidatePoolSize: 2,\n  });\n  const slnc = silence(new AudioContext());\n  const video = black({ width: 640, height: 480 });\n  const screenshare = black({ width: 640, height: 480 });\n  conn.addTrack(slnc.getTracks()[0], slnc);\n  conn.addTrack(video.getTracks()[0], video);\n  conn.addTrack(screenshare.getTracks()[0], screenshare);\n\n  conn.onicecandidate = (e) => {\n    if (!e.candidate) return;\n\n    const { candidate } = e.candidate;\n    if(!isP2p && !isRelayAddress(candidate)) {\n      return;\n    }\n\n    const candidateWithoutRelatedAddress = !isP2p ? removeRelatedAddress(candidate) : candidate;\n\n    emitSignalingData({\n      '@type': 'Candidates',\n      candidates: [{\n        sdpString: candidateWithoutRelatedAddress,\n      }],\n    });\n  };\n\n  conn.onconnectionstatechange = () => {\n    onUpdate({\n      '@type': 'updatePhoneCallConnectionState',\n      connectionState: conn.connectionState,\n    });\n  };\n\n  conn.ontrack = (e) => {\n    if (!state) return;\n\n    const stream = e.streams[0];\n    if (e.track.kind === 'audio') {\n      state.audio.srcObject = stream;\n      state.audio.play().catch();\n      state.streams.audio = stream;\n    } else if (e.transceiver.mid === '1') {\n      state.streams.video = stream;\n    } else {\n      state.streams.presentation = stream;\n    }\n\n    updateStreams();\n  };\n\n  const dc = conn.createDataChannel('data', {\n    id: 0,\n    negotiated: true,\n  });\n\n  dc.onmessage = (e) => {\n    processSignalingMessage(JSON.parse(e.data));\n  };\n\n  const audio = new Audio();\n\n  state = {\n    audio,\n    connection: conn,\n    emitSignalingData,\n    isOutgoing,\n    candidates: [],\n    onUpdate,\n    streams: {\n      ownVideo: video,\n      ownAudio: slnc,\n      ownPresentation: screenshare,\n    },\n    mediaState: {\n      isBatteryLow: false,\n      screencastState: 'inactive',\n      videoState: 'inactive',\n      videoRotation: 0,\n      isMuted: true,\n    },\n    blackVideo: video,\n    blackPresentation: screenshare,\n    silence: slnc,\n    dataChannel: dc,\n  };\n\n  try {\n    if (shouldStartVideo) {\n      toggleStreamP2p('video', true);\n    }\n    toggleStreamP2p('audio', true);\n  } catch (e) {\n\n  }\n\n  if (isOutgoing) {\n    const offer = await conn.createOffer({\n      offerToReceiveAudio: true,\n      offerToReceiveVideo: true,\n    });\n\n    await conn.setLocalDescription(offer);\n\n    sendInitialSetup(parseSdp(offer, true) as P2pParsedSdp);\n  }\n}\n\nexport function stopPhoneCall() {\n  if (!state) return;\n\n  state.streams.ownVideo?.getTracks().forEach((track) => track.stop());\n  state.streams.ownPresentation?.getTracks().forEach((track) => track.stop());\n  state.streams.ownAudio?.getTracks().forEach((track) => track.stop());\n  state.dataChannel.close();\n  state.connection.close();\n  state = undefined;\n}\n\nfunction sendMediaState() {\n  if (!state) return;\n  const { emitSignalingData, streams } = state;\n\n  emitSignalingData({\n    '@type': 'MediaState',\n    videoRotation: 0,\n    isMuted: !streams.ownAudio?.getTracks()[0].enabled,\n    isBatteryLow: true,\n    videoState: streams.ownVideo?.getTracks()[0].enabled ? 'active' : 'inactive',\n    screencastState: streams.ownPresentation?.getTracks()[0].enabled ? 'active' : 'inactive',\n  });\n}\n\nfunction filterVP8(mediaContent: MediaContent) {\n  if (!state || state.isOutgoing) return mediaContent;\n\n  const { payloadTypes } = mediaContent!;\n  const idx = payloadTypes.findIndex((payloadType) => payloadType.name === 'VP8');\n  const vp8PayloadType = payloadTypes[idx];\n  const rtxIdx = payloadTypes.findIndex((payloadType) => Number(payloadType.parameters?.apt) === vp8PayloadType.id);\n  mediaContent.payloadTypes = [payloadTypes[idx], payloadTypes[rtxIdx]];\n\n  return mediaContent;\n}\n\nfunction sendInitialSetup(sdp: P2pParsedSdp) {\n  if (!state) return;\n  const { emitSignalingData } = state;\n\n  if (!sdp.ssrc || !sdp['ssrc-groups'] || !sdp['ssrc-groups'][0] || !sdp['ssrc-groups'][1]) return;\n\n  emitSignalingData({\n    '@type': 'InitialSetup',\n    fingerprints: sdp.fingerprints,\n    ufrag: sdp.ufrag,\n    pwd: sdp.pwd,\n    audio: {\n      ssrc: fromTelegramSource(sdp.ssrc).toString(),\n      ssrcGroups: [],\n      payloadTypes: sdp.audioPayloadTypes,\n      rtpExtensions: sdp.audioExtmap,\n    },\n    video: filterVP8({\n      ssrc: fromTelegramSource(sdp['ssrc-groups'][0].sources[0]).toString(),\n      ssrcGroups: [{\n        semantics: sdp['ssrc-groups'][0].semantics,\n        ssrcs: sdp['ssrc-groups'][0].sources.map(fromTelegramSource),\n      }],\n      payloadTypes: sdp.videoPayloadTypes,\n      rtpExtensions: sdp.videoExtmap,\n    }),\n    screencast: filterVP8({\n      ssrc: fromTelegramSource(sdp['ssrc-groups'][1].sources[0]).toString(),\n      ssrcGroups: [{\n        semantics: sdp['ssrc-groups'][1].semantics,\n        ssrcs: sdp['ssrc-groups'][1].sources.map(fromTelegramSource),\n      }],\n      payloadTypes: sdp.screencastPayloadTypes,\n      rtpExtensions: sdp.screencastExtmap,\n    }),\n  });\n}\n\nexport async function processSignalingMessage(message: P2pMessage) {\n  if (!state || !state.connection) return;\n\n  console.log(message);\n\n  switch (message['@type']) {\n    case 'MediaState': {\n      state.mediaState = message;\n      updateStreams();\n      sendMediaState();\n      break;\n    }\n    case 'Candidates': {\n      const { candidates, gotInitialSetup } = state;\n\n      if (!candidates) return;\n\n      message.candidates.forEach((candidate) => {\n        state!.candidates.push(candidate.sdpString);\n      });\n\n      if (gotInitialSetup) {\n        await Promise.all(state.candidates.map((c) => state!.connection.addIceCandidate({\n          candidate: c,\n          sdpMLineIndex: 0,\n        })));\n      }\n\n      break;\n    }\n    case 'InitialSetup': {\n      const {\n        connection, isOutgoing,\n      } = state;\n      if (!connection) return;\n\n      const newConference = {\n        transport: {\n          candidates: [],\n          ufrag: message.ufrag,\n          pwd: message.pwd,\n          fingerprints: message.fingerprints,\n          'rtcp-mux': false,\n          xmlns: '',\n        },\n        sessionId: Date.now(),\n        ssrcs: [\n          message.audio && {\n            isVideo: false,\n            isMain: false,\n            userId: '123',\n            endpoint: '0',\n            mid: '0',\n            sourceGroups: [{\n              semantics: 'FID',\n              sources: [message.audio.ssrc],\n            }],\n          },\n          message.video && {\n            isVideo: true,\n            isPresentation: false,\n            isMain: false,\n            userId: '123',\n            endpoint: '1',\n            mid: '1',\n            sourceGroups: message.video.ssrcGroups.map((l) => ({\n              semantics: l.semantics,\n              sources: l.ssrcs,\n            })),\n          },\n          message.screencast && {\n            isVideo: true,\n            isPresentation: true,\n            isMain: false,\n            userId: '123',\n            endpoint: '2',\n            mid: '2',\n            sourceGroups: message.screencast.ssrcGroups.map((l) => ({\n              semantics: l.semantics,\n              sources: l.ssrcs,\n            })),\n          },\n        ],\n        audioPayloadTypes: message.audio!.payloadTypes?.map(p2pPayloadTypeToConference) || [],\n        audioExtensions: message.audio!.rtpExtensions,\n        videoPayloadTypes: filterVP8(message.video!).payloadTypes?.map(p2pPayloadTypeToConference) || [],\n        videoExtensions: message.video!.rtpExtensions,\n      } as Conference;\n\n      await connection.setRemoteDescription({\n        sdp: buildSdp(newConference, isOutgoing, undefined, true),\n        type: isOutgoing ? 'answer' : 'offer',\n      });\n\n      state.conference = newConference;\n\n      if (!isOutgoing) {\n        const answer = await connection.createAnswer();\n        if (!answer) return;\n\n        await connection.setLocalDescription(answer);\n\n        sendInitialSetup(parseSdp(answer, true) as P2pParsedSdp);\n      }\n\n      state.gotInitialSetup = true;\n      await Promise.all(state.candidates.map((c) => connection.addIceCandidate({\n        candidate: c,\n        sdpMLineIndex: 0,\n      })));\n\n      break;\n    }\n  }\n}\n","import { addActionHandler, getGlobal, setGlobal } from '../../index';\nimport {\n  joinGroupCall,\n  startSharingScreen,\n  leaveGroupCall,\n  toggleStream,\n  isStreamEnabled,\n  setVolume, stopPhoneCall,\n} from '../../../lib/secret-sauce';\n\nimport type { ActionReturnType } from '../../types';\n\nimport { GROUP_CALL_VOLUME_MULTIPLIER } from '../../../config';\nimport { callApi } from '../../../api/gramjs';\nimport { selectChat, selectTabState, selectUser } from '../../selectors';\nimport {\n  selectActiveGroupCall, selectPhoneCallUser,\n} from '../../selectors/calls';\nimport {\n  removeGroupCall,\n  updateActiveGroupCall,\n} from '../../reducers/calls';\nimport { getGroupCallAudioContext, getGroupCallAudioElement, removeGroupCallAudioElement } from '../ui/calls';\nimport { loadFullChat } from './chats';\nimport { addUsers } from '../../reducers';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { updateTabState } from '../../reducers/tabs';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\n\nconst HANG_UP_UI_DELAY = 500;\n\naddActionHandler('leaveGroupCall', async (global, actions, payload): Promise<void> => {\n  const {\n    isFromLibrary, shouldDiscard, shouldRemove, rejoin,\n    isPageUnload, tabId = getCurrentTabId(),\n  } = payload || {};\n\n  const groupCall = selectActiveGroupCall(global);\n  if (!groupCall) {\n    return;\n  }\n\n  global = updateActiveGroupCall(global, { connectionState: 'disconnected' }, groupCall.participantsCount - 1);\n  global = {\n    ...global,\n    groupCalls: {\n      ...global.groupCalls,\n      activeGroupCallId: undefined,\n    },\n  };\n  setGlobal(global);\n\n  await callApi('leaveGroupCall', {\n    call: groupCall, isPageUnload,\n  });\n  await callApi('abortRequestGroup', 'call');\n\n  if (shouldDiscard) {\n    await callApi('discardGroupCall', {\n      call: groupCall,\n    });\n  }\n\n  global = getGlobal();\n  if (shouldRemove) {\n    global = removeGroupCall(global, groupCall.id);\n  }\n\n  removeGroupCallAudioElement();\n\n  setGlobal(global);\n\n  actions.toggleGroupCallPanel({ force: undefined, tabId });\n\n  if (!isFromLibrary) {\n    leaveGroupCall();\n  }\n\n  actions.afterHangUp();\n\n  if (rejoin) {\n    actions.requestMasterAndJoinGroupCall({\n      ...rejoin,\n      tabId,\n    });\n  }\n});\n\naddActionHandler('toggleGroupCallVideo', async (global): Promise<void> => {\n  const groupCall = selectActiveGroupCall(global);\n  const user = selectUser(global, global.currentUserId!);\n  if (!user || !groupCall) {\n    return;\n  }\n\n  await toggleStream('video');\n\n  await callApi('editGroupCallParticipant', {\n    call: groupCall,\n    videoStopped: !isStreamEnabled('video'),\n    participant: user,\n  });\n});\n\naddActionHandler('requestToSpeak', (global, actions, payload): ActionReturnType => {\n  const { value } = payload || { value: true };\n  const groupCall = selectActiveGroupCall(global);\n  const user = selectUser(global, global.currentUserId!);\n  if (!user || !groupCall) {\n    return;\n  }\n\n  void callApi('editGroupCallParticipant', {\n    call: groupCall,\n    raiseHand: value,\n    participant: user,\n  });\n});\n\naddActionHandler('setGroupCallParticipantVolume', (global, actions, payload): ActionReturnType => {\n  const { participantId, volume } = payload!;\n\n  const groupCall = selectActiveGroupCall(global);\n  const user = selectUser(global, participantId);\n  if (!user || !groupCall) {\n    return;\n  }\n\n  setVolume(participantId, Math.floor(volume / GROUP_CALL_VOLUME_MULTIPLIER) / 100);\n\n  void callApi('editGroupCallParticipant', {\n    call: groupCall,\n    volume: Number(volume),\n    participant: user,\n  });\n});\n\naddActionHandler('toggleGroupCallMute', async (global, actions, payload): Promise<void> => {\n  const { participantId, value } = payload || {};\n  const groupCall = selectActiveGroupCall(global);\n  const user = selectUser(global, participantId || global.currentUserId!);\n  if (!user || !groupCall) {\n    return;\n  }\n\n  const muted = value === undefined ? isStreamEnabled('audio', user.id) : value;\n\n  if (!participantId) {\n    await toggleStream('audio');\n  } else {\n    setVolume(participantId, muted ? 0 : 1);\n  }\n\n  await callApi('editGroupCallParticipant', {\n    call: groupCall,\n    muted,\n    participant: user,\n  });\n});\n\naddActionHandler('toggleGroupCallPresentation', async (global, actions, payload): Promise<void> => {\n  const groupCall = selectActiveGroupCall(global);\n  const user = selectUser(global, global.currentUserId!);\n  if (!user || !groupCall) {\n    return;\n  }\n\n  const value = payload?.value !== undefined ? payload?.value : !isStreamEnabled('presentation');\n  if (value) {\n    const params = await startSharingScreen();\n    if (!params) {\n      return;\n    }\n\n    await callApi('joinGroupCallPresentation', {\n      call: groupCall,\n      params,\n    });\n  } else {\n    await toggleStream('presentation', false);\n    await callApi('leaveGroupCallPresentation', {\n      call: groupCall,\n    });\n  }\n\n  await callApi('editGroupCallParticipant', {\n    call: groupCall,\n    presentationPaused: !isStreamEnabled('presentation'),\n    participant: user,\n  });\n});\n\naddActionHandler('connectToActiveGroupCall', async (global, actions, payload): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload || {};\n  const groupCall = selectActiveGroupCall(global);\n  if (!groupCall) return;\n\n  if (groupCall.connectionState === 'discarded') {\n    actions.showNotification({ message: 'This voice chat is not active', tabId });\n    return;\n  }\n\n  const audioElement = getGroupCallAudioElement();\n  const audioContext = getGroupCallAudioContext();\n\n  if (!audioElement || !audioContext) {\n    return;\n  }\n\n  const {\n    currentUserId,\n  } = global;\n\n  if (!currentUserId) return;\n\n  const params = await joinGroupCall(currentUserId, audioContext, audioElement, actions.apiUpdate);\n\n  const result = await callApi('joinGroupCall', {\n    call: groupCall,\n    params,\n    inviteHash: groupCall.inviteHash,\n  });\n\n  global = getGlobal();\n\n  if (!result) {\n    actions.showNotification({\n      // TODO[lang] Localize error message\n      message: 'Failed to join voice chat',\n      tabId,\n    });\n    actions.leaveGroupCall({ tabId });\n    return;\n  }\n\n  actions.loadMoreGroupCallParticipants();\n\n  if (groupCall.chatId) {\n    global = getGlobal();\n    const chat = selectChat(global, groupCall.chatId);\n    if (!chat) return;\n    await loadFullChat(global, actions, chat, tabId);\n  }\n});\n\naddActionHandler('connectToActivePhoneCall', async (global, actions): Promise<void> => {\n  const { phoneCall } = global;\n\n  if (!phoneCall) return;\n\n  const user = selectPhoneCallUser(global);\n\n  if (!user) return;\n\n  const dhConfig = await callApi('getDhConfig');\n\n  if (!dhConfig) return;\n\n  await callApi('createPhoneCallState', [true]);\n\n  const gAHash = await callApi('requestPhoneCall', [dhConfig])!;\n\n  const result = await callApi('requestCall', { user, gAHash, isVideo: phoneCall.isVideo });\n\n  if (!result) {\n    if ('hangUp' in actions) actions.hangUp({ tabId: getCurrentTabId() });\n    return;\n  }\n  global = getGlobal();\n  global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n  setGlobal(global);\n});\n\naddActionHandler('acceptCall', async (global): Promise<void> => {\n  const { phoneCall } = global;\n\n  if (!phoneCall) return;\n\n  const dhConfig = await callApi('getDhConfig');\n  if (!dhConfig) return;\n\n  await callApi('createPhoneCallState', [false]);\n\n  const gB = await callApi('acceptPhoneCall', [dhConfig])!;\n  const result = await callApi('acceptCall', { call: phoneCall, gB });\n  if (!result) {\n    return;\n  }\n  global = getGlobal();\n  global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n  setGlobal(global);\n});\n\naddActionHandler('sendSignalingData', (global, actions, payload): ActionReturnType => {\n  const { phoneCall } = global;\n  if (!phoneCall) {\n    return;\n  }\n\n  const data = JSON.stringify(payload);\n\n  (async () => {\n    const encodedData = await callApi('encodePhoneCallData', [data]);\n\n    if (!encodedData) return;\n\n    callApi('sendSignalingData', { data: encodedData, call: phoneCall });\n  })();\n});\n\naddActionHandler('closeCallRatingModal', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n  return updateTabState(global, {\n    ratingPhoneCall: undefined,\n  }, tabId);\n});\n\naddActionHandler('setCallRating', (global, actions, payload): ActionReturnType => {\n  const { rating, comment, tabId = getCurrentTabId() } = payload;\n\n  const { ratingPhoneCall } = selectTabState(global, tabId);\n  if (!ratingPhoneCall) {\n    return undefined;\n  }\n\n  callApi('setCallRating', { call: ratingPhoneCall, rating, comment });\n\n  return updateTabState(global, {\n    ratingPhoneCall: undefined,\n  }, tabId);\n});\n\naddActionHandler('hangUp', (global, actions, payload): ActionReturnType => {\n  const { isPageUnload, tabId = getCurrentTabId() } = payload || {};\n  const { phoneCall } = global;\n\n  if (!phoneCall) return undefined;\n\n  if (phoneCall.state === 'discarded') {\n    callApi('destroyPhoneCallState');\n    stopPhoneCall();\n\n    global = {\n      ...global,\n      phoneCall: undefined,\n    };\n    setGlobal(global);\n    actions.toggleGroupCallPanel({ force: undefined, tabId });\n\n    actions.afterHangUp();\n\n    return undefined;\n  }\n\n  callApi('destroyPhoneCallState');\n  stopPhoneCall();\n  callApi('discardCall', { call: phoneCall, isPageUnload });\n\n  if (phoneCall.state === 'requesting') {\n    global = {\n      ...global,\n      phoneCall: undefined,\n    };\n    setGlobal(global);\n    actions.toggleGroupCallPanel({ force: undefined, tabId });\n\n    actions.afterHangUp();\n\n    return undefined;\n  }\n\n  setTimeout(() => {\n    global = getGlobal();\n    global = {\n      ...global,\n      phoneCall: undefined,\n    };\n    setGlobal(global);\n\n    actions.toggleGroupCallPanel({ force: undefined, tabId });\n    actions.afterHangUp();\n  }, HANG_UP_UI_DELAY);\n\n  return undefined;\n});\n","export const EMOJI_DATA = new Uint16Array([\n  0xd83d, 0xde09, 0xd83d, 0xde0d, 0xd83d, 0xde1b, 0xd83d, 0xde2d, 0xd83d, 0xde31, 0xd83d, 0xde21,\n  0xd83d, 0xde0e, 0xd83d, 0xde34, 0xd83d, 0xde35, 0xd83d, 0xde08, 0xd83d, 0xde2c, 0xd83d, 0xde07,\n  0xd83d, 0xde0f, 0xd83d, 0xdc6e, 0xd83d, 0xdc77, 0xd83d, 0xdc82, 0xd83d, 0xdc76, 0xd83d, 0xdc68,\n  0xd83d, 0xdc69, 0xd83d, 0xdc74, 0xd83d, 0xdc75, 0xd83d, 0xde3b, 0xd83d, 0xde3d, 0xd83d, 0xde40,\n  0xd83d, 0xdc7a, 0xd83d, 0xde48, 0xd83d, 0xde49, 0xd83d, 0xde4a, 0xd83d, 0xdc80, 0xd83d, 0xdc7d,\n  0xd83d, 0xdca9, 0xd83d, 0xdd25, 0xd83d, 0xdca5, 0xd83d, 0xdca4, 0xd83d, 0xdc42, 0xd83d, 0xdc40,\n  0xd83d, 0xdc43, 0xd83d, 0xdc45, 0xd83d, 0xdc44, 0xd83d, 0xdc4d, 0xd83d, 0xdc4e, 0xd83d, 0xdc4c,\n  0xd83d, 0xdc4a, 0x270c, 0x270b, 0xd83d, 0xdc50, 0xd83d, 0xdc46, 0xd83d, 0xdc47, 0xd83d, 0xdc49,\n  0xd83d, 0xdc48, 0xd83d, 0xde4f, 0xd83d, 0xdc4f, 0xd83d, 0xdcaa, 0xd83d, 0xdeb6, 0xd83c, 0xdfc3,\n  0xd83d, 0xdc83, 0xd83d, 0xdc6b, 0xd83d, 0xdc6a, 0xd83d, 0xdc6c, 0xd83d, 0xdc6d, 0xd83d, 0xdc85,\n  0xd83c, 0xdfa9, 0xd83d, 0xdc51, 0xd83d, 0xdc52, 0xd83d, 0xdc5f, 0xd83d, 0xdc5e, 0xd83d, 0xdc60,\n  0xd83d, 0xdc55, 0xd83d, 0xdc57, 0xd83d, 0xdc56, 0xd83d, 0xdc59, 0xd83d, 0xdc5c, 0xd83d, 0xdc53,\n  0xd83c, 0xdf80, 0xd83d, 0xdc84, 0xd83d, 0xdc9b, 0xd83d, 0xdc99, 0xd83d, 0xdc9c, 0xd83d, 0xdc9a,\n  0xd83d, 0xdc8d, 0xd83d, 0xdc8e, 0xd83d, 0xdc36, 0xd83d, 0xdc3a, 0xd83d, 0xdc31, 0xd83d, 0xdc2d,\n  0xd83d, 0xdc39, 0xd83d, 0xdc30, 0xd83d, 0xdc38, 0xd83d, 0xdc2f, 0xd83d, 0xdc28, 0xd83d, 0xdc3b,\n  0xd83d, 0xdc37, 0xd83d, 0xdc2e, 0xd83d, 0xdc17, 0xd83d, 0xdc34, 0xd83d, 0xdc11, 0xd83d, 0xdc18,\n  0xd83d, 0xdc3c, 0xd83d, 0xdc27, 0xd83d, 0xdc25, 0xd83d, 0xdc14, 0xd83d, 0xdc0d, 0xd83d, 0xdc22,\n  0xd83d, 0xdc1b, 0xd83d, 0xdc1d, 0xd83d, 0xdc1c, 0xd83d, 0xdc1e, 0xd83d, 0xdc0c, 0xd83d, 0xdc19,\n  0xd83d, 0xdc1a, 0xd83d, 0xdc1f, 0xd83d, 0xdc2c, 0xd83d, 0xdc0b, 0xd83d, 0xdc10, 0xd83d, 0xdc0a,\n  0xd83d, 0xdc2b, 0xd83c, 0xdf40, 0xd83c, 0xdf39, 0xd83c, 0xdf3b, 0xd83c, 0xdf41, 0xd83c, 0xdf3e,\n  0xd83c, 0xdf44, 0xd83c, 0xdf35, 0xd83c, 0xdf34, 0xd83c, 0xdf33, 0xd83c, 0xdf1e, 0xd83c, 0xdf1a,\n  0xd83c, 0xdf19, 0xd83c, 0xdf0e, 0xd83c, 0xdf0b, 0x26a1, 0x2614, 0x2744, 0x26c4, 0xd83c, 0xdf00,\n  0xd83c, 0xdf08, 0xd83c, 0xdf0a, 0xd83c, 0xdf93, 0xd83c, 0xdf86, 0xd83c, 0xdf83, 0xd83d, 0xdc7b,\n  0xd83c, 0xdf85, 0xd83c, 0xdf84, 0xd83c, 0xdf81, 0xd83c, 0xdf88, 0xd83d, 0xdd2e, 0xd83c, 0xdfa5,\n  0xd83d, 0xdcf7, 0xd83d, 0xdcbf, 0xd83d, 0xdcbb, 0x260e, 0xd83d, 0xdce1, 0xd83d, 0xdcfa, 0xd83d,\n  0xdcfb, 0xd83d, 0xdd09, 0xd83d, 0xdd14, 0x23f3, 0x23f0, 0x231a, 0xd83d, 0xdd12, 0xd83d, 0xdd11,\n  0xd83d, 0xdd0e, 0xd83d, 0xdca1, 0xd83d, 0xdd26, 0xd83d, 0xdd0c, 0xd83d, 0xdd0b, 0xd83d, 0xdebf,\n  0xd83d, 0xdebd, 0xd83d, 0xdd27, 0xd83d, 0xdd28, 0xd83d, 0xdeaa, 0xd83d, 0xdeac, 0xd83d, 0xdca3,\n  0xd83d, 0xdd2b, 0xd83d, 0xdd2a, 0xd83d, 0xdc8a, 0xd83d, 0xdc89, 0xd83d, 0xdcb0, 0xd83d, 0xdcb5,\n  0xd83d, 0xdcb3, 0x2709, 0xd83d, 0xdceb, 0xd83d, 0xdce6, 0xd83d, 0xdcc5, 0xd83d, 0xdcc1, 0x2702,\n  0xd83d, 0xdccc, 0xd83d, 0xdcce, 0x2712, 0x270f, 0xd83d, 0xdcd0, 0xd83d, 0xdcda, 0xd83d, 0xdd2c,\n  0xd83d, 0xdd2d, 0xd83c, 0xdfa8, 0xd83c, 0xdfac, 0xd83c, 0xdfa4, 0xd83c, 0xdfa7, 0xd83c, 0xdfb5,\n  0xd83c, 0xdfb9, 0xd83c, 0xdfbb, 0xd83c, 0xdfba, 0xd83c, 0xdfb8, 0xd83d, 0xdc7e, 0xd83c, 0xdfae,\n  0xd83c, 0xdccf, 0xd83c, 0xdfb2, 0xd83c, 0xdfaf, 0xd83c, 0xdfc8, 0xd83c, 0xdfc0, 0x26bd, 0x26be,\n  0xd83c, 0xdfbe, 0xd83c, 0xdfb1, 0xd83c, 0xdfc9, 0xd83c, 0xdfb3, 0xd83c, 0xdfc1, 0xd83c, 0xdfc7,\n  0xd83c, 0xdfc6, 0xd83c, 0xdfca, 0xd83c, 0xdfc4, 0x2615, 0xd83c, 0xdf7c, 0xd83c, 0xdf7a, 0xd83c,\n  0xdf77, 0xd83c, 0xdf74, 0xd83c, 0xdf55, 0xd83c, 0xdf54, 0xd83c, 0xdf5f, 0xd83c, 0xdf57, 0xd83c,\n  0xdf71, 0xd83c, 0xdf5a, 0xd83c, 0xdf5c, 0xd83c, 0xdf61, 0xd83c, 0xdf73, 0xd83c, 0xdf5e, 0xd83c,\n  0xdf69, 0xd83c, 0xdf66, 0xd83c, 0xdf82, 0xd83c, 0xdf70, 0xd83c, 0xdf6a, 0xd83c, 0xdf6b, 0xd83c,\n  0xdf6d, 0xd83c, 0xdf6f, 0xd83c, 0xdf4e, 0xd83c, 0xdf4f, 0xd83c, 0xdf4a, 0xd83c, 0xdf4b, 0xd83c,\n  0xdf52, 0xd83c, 0xdf47, 0xd83c, 0xdf49, 0xd83c, 0xdf53, 0xd83c, 0xdf51, 0xd83c, 0xdf4c, 0xd83c,\n  0xdf50, 0xd83c, 0xdf4d, 0xd83c, 0xdf46, 0xd83c, 0xdf45, 0xd83c, 0xdf3d, 0xd83c, 0xdfe1, 0xd83c,\n  0xdfe5, 0xd83c, 0xdfe6, 0x26ea, 0xd83c, 0xdff0, 0x26fa, 0xd83c, 0xdfed, 0xd83d, 0xddfb, 0xd83d,\n  0xddfd, 0xd83c, 0xdfa0, 0xd83c, 0xdfa1, 0x26f2, 0xd83c, 0xdfa2, 0xd83d, 0xdea2, 0xd83d, 0xdea4,\n  0x2693, 0xd83d, 0xde80, 0x2708, 0xd83d, 0xde81, 0xd83d, 0xde82, 0xd83d, 0xde8b, 0xd83d, 0xde8e,\n  0xd83d, 0xde8c, 0xd83d, 0xde99, 0xd83d, 0xde97, 0xd83d, 0xde95, 0xd83d, 0xde9b, 0xd83d, 0xdea8,\n  0xd83d, 0xde94, 0xd83d, 0xde92, 0xd83d, 0xde91, 0xd83d, 0xdeb2, 0xd83d, 0xdea0, 0xd83d, 0xde9c,\n  0xd83d, 0xdea6, 0x26a0, 0xd83d, 0xdea7, 0x26fd, 0xd83c, 0xdfb0, 0xd83d, 0xddff, 0xd83c, 0xdfaa,\n  0xd83c, 0xdfad, 0xd83c, 0xddef, 0xd83c, 0xddf5, 0xd83c, 0xddf0, 0xd83c, 0xddf7, 0xd83c, 0xdde9,\n  0xd83c, 0xddea, 0xd83c, 0xdde8, 0xd83c, 0xddf3, 0xd83c, 0xddfa, 0xd83c, 0xddf8, 0xd83c, 0xddeb,\n  0xd83c, 0xddf7, 0xd83c, 0xddea, 0xd83c, 0xddf8, 0xd83c, 0xddee, 0xd83c, 0xddf9, 0xd83c, 0xddf7,\n  0xd83c, 0xddfa, 0xd83c, 0xddec, 0xd83c, 0xdde7, 0x0031, 0x20e3, 0x0032, 0x20e3, 0x0033, 0x20e3,\n  0x0034, 0x20e3, 0x0035, 0x20e3, 0x0036, 0x20e3, 0x0037, 0x20e3, 0x0038, 0x20e3, 0x0039, 0x20e3,\n  0x0030, 0x20e3, 0xd83d, 0xdd1f, 0x2757, 0x2753, 0x2665, 0x2666, 0xd83d, 0xdcaf, 0xd83d, 0xdd17,\n  0xd83d, 0xdd31, 0xd83d, 0xdd34, 0xd83d, 0xdd35, 0xd83d, 0xdd36, 0xd83d, 0xdd37,\n]);\n\nexport const EMOJI_OFFSETS = [\n  0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22,\n  24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46,\n  48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70,\n  72, 74, 76, 78, 80, 82, 84, 86, 87, 88, 90, 92,\n  94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116,\n  118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140,\n  142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164,\n  166, 168, 170, 172, 174, 176, 178, 180, 182, 184, 186, 188,\n  190, 192, 194, 196, 198, 200, 202, 204, 206, 208, 210, 212,\n  214, 216, 218, 220, 222, 224, 226, 228, 230, 232, 234, 236,\n  238, 240, 242, 244, 246, 248, 250, 252, 254, 256, 258, 259,\n  260, 261, 262, 264, 266, 268, 270, 272, 274, 276, 278, 280,\n  282, 284, 286, 288, 290, 292, 294, 295, 297, 299, 301, 303,\n  305, 306, 307, 308, 310, 312, 314, 316, 318, 320, 322, 324,\n  326, 328, 330, 332, 334, 336, 338, 340, 342, 344, 346, 348,\n  350, 351, 353, 355, 357, 359, 360, 362, 364, 365, 366, 368,\n  370, 372, 374, 376, 378, 380, 382, 384, 386, 388, 390, 392,\n  394, 396, 398, 400, 402, 404, 406, 407, 408, 410, 412, 414,\n  416, 418, 420, 422, 424, 426, 427, 429, 431, 433, 435, 437,\n  439, 441, 443, 445, 447, 449, 451, 453, 455, 457, 459, 461,\n  463, 465, 467, 469, 471, 473, 475, 477, 479, 481, 483, 485,\n  487, 489, 491, 493, 495, 497, 499, 501, 503, 505, 507, 508,\n  510, 511, 513, 515, 517, 519, 521, 522, 524, 526, 528, 529,\n  531, 532, 534, 536, 538, 540, 542, 544, 546, 548, 550, 552,\n  554, 556, 558, 560, 562, 564, 566, 567, 569, 570, 572, 574,\n  576, 578, 582, 586, 590, 594, 598, 602, 606, 610, 614, 618,\n  620, 622, 624, 626, 628, 630, 632, 634, 636, 638, 640, 641,\n  642, 643, 644, 646, 648, 650, 652, 654, 656, 658,\n];\n","import { addActionHandler, getGlobal, setGlobal } from '../../index';\nimport { selectActiveGroupCall, selectGroupCallParticipant, selectPhoneCallUser } from '../../selectors/calls';\nimport { updateGroupCall, updateGroupCallParticipant } from '../../reducers/calls';\nimport { buildCollectionByKey, omit } from '../../../util/iteratees';\nimport type { ApiCallProtocol } from '../../../lib/secret-sauce';\nimport {\n  handleUpdateGroupCallConnection,\n  handleUpdateGroupCallParticipants,\n  joinPhoneCall, processSignalingMessage,\n} from '../../../lib/secret-sauce';\nimport type { ApiPhoneCall } from '../../../api/types';\nimport { ARE_CALLS_SUPPORTED } from '../../../util/windowEnvironment';\nimport { callApi } from '../../../api/gramjs';\nimport * as langProvider from '../../../util/langProvider';\nimport { EMOJI_DATA, EMOJI_OFFSETS } from '../../../util/phoneCallEmojiConstants';\nimport type { ActionReturnType } from '../../types';\nimport { updateTabState } from '../../reducers/tabs';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { addUsers } from '../../reducers';\n\naddActionHandler('apiUpdate', (global, actions, update): ActionReturnType => {\n  const { activeGroupCallId } = global.groupCalls;\n\n  switch (update['@type']) {\n    case 'updateGroupCallLeavePresentation': {\n      actions.toggleGroupCallPresentation({ value: false });\n      break;\n    }\n    case 'updateGroupCallStreams': {\n      if (!update.userId || !activeGroupCallId) break;\n      if (!selectGroupCallParticipant(global, activeGroupCallId, update.userId)) break;\n\n      return updateGroupCallParticipant(global, activeGroupCallId, update.userId, omit(update, ['@type', 'userId']));\n    }\n    case 'updateGroupCallConnectionState': {\n      if (!activeGroupCallId) break;\n\n      if (update.connectionState === 'disconnected') {\n        if ('leaveGroupCall' in actions) actions.leaveGroupCall({ isFromLibrary: true, tabId: getCurrentTabId() });\n        break;\n      }\n\n      return updateGroupCall(global, activeGroupCallId, {\n        connectionState: update.connectionState,\n        isSpeakerDisabled: update.isSpeakerDisabled,\n      });\n    }\n    case 'updateGroupCallParticipants': {\n      const { groupCallId, participants } = update;\n      if (activeGroupCallId === groupCallId) {\n        void handleUpdateGroupCallParticipants(participants);\n      }\n      break;\n    }\n    case 'updateGroupCallConnection': {\n      if (update.data.stream) {\n        actions.showNotification({ message: 'Big live streams are not yet supported', tabId: getCurrentTabId() });\n        if ('leaveGroupCall' in actions) actions.leaveGroupCall({ tabId: getCurrentTabId() });\n        break;\n      }\n      void handleUpdateGroupCallConnection(update.data, update.presentation);\n\n      const groupCall = selectActiveGroupCall(global);\n      if (groupCall?.participants && Object.keys(groupCall.participants).length > 0) {\n        void handleUpdateGroupCallParticipants(Object.values(groupCall.participants));\n      }\n      break;\n    }\n    case 'updatePhoneCallMediaState':\n      return {\n        ...global,\n        phoneCall: {\n          ...global.phoneCall,\n          ...omit(update, ['@type']),\n        } as ApiPhoneCall,\n      };\n    case 'updatePhoneCall': {\n      if (!ARE_CALLS_SUPPORTED) return undefined;\n      const { phoneCall, currentUserId } = global;\n\n      const call: ApiPhoneCall = {\n        ...phoneCall,\n        ...update.call,\n      };\n\n      const isOutgoing = phoneCall?.adminId === currentUserId;\n\n      global = {\n        ...global,\n        phoneCall: call,\n      };\n\n      if (phoneCall && phoneCall.id && call.id !== phoneCall.id) {\n        if (call.state !== 'discarded') {\n          callApi('discardCall', {\n            call,\n            isBusy: true,\n          });\n        }\n        return undefined;\n      }\n\n      const {\n        accessHash, state, connections, gB,\n      } = call;\n\n      if (state === 'active' || state === 'accepted') {\n        if (!verifyPhoneCallProtocol(call.protocol)) {\n          const user = selectPhoneCallUser(global);\n          if ('hangUp' in actions) actions.hangUp({ tabId: getCurrentTabId() });\n          actions.showNotification({\n            message: langProvider.translate('VoipPeerIncompatible', user?.firstName),\n            tabId: getCurrentTabId(),\n          });\n          return undefined;\n        }\n      }\n\n      if (state === 'discarded') {\n        // Discarded from other device\n        if (!phoneCall) return undefined;\n\n        return updateTabState(global, {\n          ...(call.needRating && { ratingPhoneCall: call }),\n          isCallPanelVisible: undefined,\n        }, getCurrentTabId());\n      } else if (state === 'accepted' && accessHash && gB) {\n        (async () => {\n          const { gA, keyFingerprint, emojis } = await callApi('confirmPhoneCall', [gB, EMOJI_DATA, EMOJI_OFFSETS])!;\n\n          global = getGlobal();\n          const newCall = {\n            ...global.phoneCall,\n            emojis,\n          } as ApiPhoneCall;\n\n          global = {\n            ...global,\n            phoneCall: newCall,\n          };\n          setGlobal(global);\n\n          const result = await callApi('confirmCall', {\n            call, gA, keyFingerprint,\n          });\n          if (result) {\n            global = getGlobal();\n            global = addUsers(global, buildCollectionByKey(result.users, 'id'));\n            setGlobal(global);\n          }\n        })();\n      } else if (state === 'active' && connections && phoneCall?.state !== 'active') {\n        if (!isOutgoing) {\n          callApi('receivedCall', { call });\n          (async () => {\n            const { emojis } = await callApi('confirmPhoneCall', [call!.gAOrB!, EMOJI_DATA, EMOJI_OFFSETS])!;\n\n            global = getGlobal();\n            const newCall = {\n              ...global.phoneCall,\n              emojis,\n            } as ApiPhoneCall;\n\n            global = {\n              ...global,\n              phoneCall: newCall,\n            };\n            setGlobal(global);\n          })();\n        }\n        void joinPhoneCall(\n          connections,\n          actions.sendSignalingData,\n          isOutgoing,\n          Boolean(call?.isVideo),\n          Boolean(call.isP2pAllowed),\n          actions.apiUpdate,\n        );\n      }\n\n      return global;\n    }\n    case 'updatePhoneCallConnectionState': {\n      const { connectionState } = update;\n\n      if (!global.phoneCall) return global;\n\n      if (connectionState === 'closed' || connectionState === 'disconnected' || connectionState === 'failed') {\n        if ('hangUp' in actions) actions.hangUp({ tabId: getCurrentTabId() });\n        return undefined;\n      }\n\n      return {\n        ...global,\n        phoneCall: {\n          ...global.phoneCall,\n          isConnected: connectionState === 'connected',\n        },\n      };\n    }\n    case 'updatePhoneCallSignalingData': {\n      const { phoneCall } = global;\n\n      if (!phoneCall) {\n        break;\n      }\n\n      callApi('decodePhoneCallData', [update.data])?.then(processSignalingMessage);\n      break;\n    }\n  }\n\n  return undefined;\n});\n\nfunction verifyPhoneCallProtocol(protocol?: ApiCallProtocol) {\n  return protocol?.libraryVersions.some((version) => {\n    return version === '4.0.0' || version === '4.0.1';\n  });\n}\n","export const vibrateShort = () => {\n  navigator.vibrate?.(50);\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"cYoMo7_F9FClYElCiCPz\",\"spinner\":\"NzuTkuoPRWdJQIgGM6HC\",\"spinnerVisible\":\"cLDJwFMhqkiwNmn9Xkx0\",\"canUnmute\":\"qogJ3qpYtfXe51F2oHQC\",\"mutedByAdmin\":\"_BwpttCUQ7dx5QS3FZr8\",\"icon\":\"Xb5vLmvwjtecjpIdukD8\"};","import type { GroupCallConnectionState } from '../../../lib/secret-sauce';\nimport type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useMemo, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport { LOCAL_TGS_URLS } from '../../common/helpers/animatedAssets';\nimport buildClassName from '../../../util/buildClassName';\nimport { vibrateShort } from '../../../util/vibrate';\nimport usePrevious from '../../../hooks/usePrevious';\nimport { selectActiveGroupCall, selectGroupCallParticipant } from '../../../global/selectors/calls';\nimport useLang from '../../../hooks/useLang';\n\nimport AnimatedIcon from '../../common/AnimatedIcon';\nimport Button from '../../ui/Button';\nimport Spinner from '../../ui/Spinner';\n\nimport styles from './MicrophoneButton.module.scss';\n\nconst CONNECTION_STATE_DEFAULT = 'discarded';\n\ntype OwnProps = {\n  className?: string;\n};\n\ntype StateProps = {\n  connectionState?: GroupCallConnectionState;\n  hasRequestedToSpeak: boolean;\n  isMuted?: boolean;\n  canSelfUnmute?: boolean;\n  noAudioStream: boolean;\n};\n\nconst REQUEST_TO_SPEAK_THROTTLE = 3000;\nconst HOLD_TO_SPEAK_TIME = 200;\nconst ICON_SIZE = 36;\n\nconst MicrophoneButton: FC<OwnProps & StateProps> = ({\n  className,\n  noAudioStream,\n  canSelfUnmute,\n  isMuted,\n  connectionState,\n}) => {\n  const {\n    toggleGroupCallMute,\n    requestToSpeak,\n    playGroupCallSound,\n  } = getActions();\n\n  const lang = useLang();\n  const muteMouseDownState = useRef('up');\n\n  const [isRequestingToSpeak, setIsRequestingToSpeak] = useState(false);\n  const isConnecting = connectionState !== 'connected';\n  const shouldRaiseHand = !canSelfUnmute && isMuted;\n  const prevShouldRaiseHand = usePrevious(shouldRaiseHand);\n\n  useEffect(() => {\n    if (prevShouldRaiseHand && !shouldRaiseHand) {\n      playGroupCallSound({ sound: 'allowTalk' });\n    }\n  }, [playGroupCallSound, prevShouldRaiseHand, shouldRaiseHand]);\n\n  // Voice mini\n  // unmuted -> muted [69, 99]\n  // muted -> unmuted [36, 69]\n  // raise -> muted [0, 36]\n  // muted -> raise [99, 136]\n  // unmuted -> raise [136, 172]\n  // TODO should probably move to other component\n  const playSegment: [number, number] = useMemo(() => {\n    if (isRequestingToSpeak) {\n      const r = Math.floor(Math.random() * 100);\n      return (r < 32 ? [0, 120]\n        : (r < 64 ? [120, 240]\n          : (r < 97 ? [240, 420]\n            : [420, 540]\n          )\n        )\n      );\n    }\n    if (!prevShouldRaiseHand && shouldRaiseHand) {\n      return noAudioStream ? [99, 135] : [136, 172];\n    }\n    if (prevShouldRaiseHand && !shouldRaiseHand) {\n      return [0, 36];\n    }\n    if (!shouldRaiseHand) {\n      return noAudioStream ? [69, 99] : [36, 69];\n    }\n    return [0, 0];\n  }, [prevShouldRaiseHand, isRequestingToSpeak, noAudioStream, shouldRaiseHand]);\n\n  const animatedIconName = isRequestingToSpeak ? 'HandFilled' : 'VoiceMini';\n\n  const toggleMute = useCallback(() => {\n    vibrateShort();\n    toggleGroupCallMute();\n  }, [toggleGroupCallMute]);\n\n  const handleMouseDownMute = useCallback(() => {\n    if (shouldRaiseHand) {\n      if (isRequestingToSpeak) return;\n      vibrateShort();\n      requestToSpeak();\n      setIsRequestingToSpeak(true);\n      setTimeout(() => {\n        setIsRequestingToSpeak(false);\n      }, REQUEST_TO_SPEAK_THROTTLE);\n      return;\n    }\n    muteMouseDownState.current = 'down';\n    if (noAudioStream) {\n      setTimeout(() => {\n        if (muteMouseDownState.current === 'down') {\n          muteMouseDownState.current = 'hold';\n          toggleMute();\n        }\n      }, HOLD_TO_SPEAK_TIME);\n    }\n  }, [isRequestingToSpeak, noAudioStream, requestToSpeak, shouldRaiseHand, toggleMute]);\n\n  const handleMouseUpMute = useCallback(() => {\n    if (shouldRaiseHand) {\n      return;\n    }\n    toggleMute();\n    muteMouseDownState.current = 'up';\n  }, [shouldRaiseHand, toggleMute]);\n\n  return (\n    <Button\n      round\n      size=\"default\"\n      className={buildClassName(\n        styles.root,\n        !isConnecting && noAudioStream && styles.canUnmute,\n        !isConnecting && shouldRaiseHand && styles.mutedByAdmin,\n        className,\n      )}\n      onMouseDown={handleMouseDownMute}\n      onMouseUp={handleMouseUpMute}\n      ariaLabel={lang(isMuted ? 'VoipUnmute' : 'VoipMute')}\n      disabled={isConnecting}\n    >\n      <AnimatedIcon\n        tgsUrl={LOCAL_TGS_URLS[animatedIconName]}\n        size={ICON_SIZE}\n        play={playSegment.toString()}\n        playSegment={playSegment}\n        className={styles.icon}\n        forceOnHeavyAnimation\n        forceInBackground\n      />\n      <Spinner className={buildClassName(styles.spinner, isConnecting && styles.spinnerVisible)} color=\"white\" />\n    </Button>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    const groupCall = selectActiveGroupCall(global);\n\n    const { connectionState } = groupCall || {};\n    const meParticipant = groupCall && selectGroupCallParticipant(global, groupCall.id, global.currentUserId!);\n\n    const {\n      raiseHandRating, hasAudioStream, canSelfUnmute, isMuted,\n    } = meParticipant || {};\n\n    return {\n      connectionState: connectionState || CONNECTION_STATE_DEFAULT,\n      hasRequestedToSpeak: Boolean(raiseHandRating),\n      noAudioStream: !hasAudioStream,\n      canSelfUnmute,\n      isMuted,\n    };\n  },\n)(MicrophoneButton));\n","import type { GroupCallParticipant } from '../../../../lib/secret-sauce';\nimport { GROUP_CALL_DEFAULT_VOLUME, GROUP_CALL_VOLUME_MULTIPLIER } from '../../../../config';\n\nexport default function formatGroupCallVolume(participant: GroupCallParticipant) {\n  return Math.floor((participant.volume || GROUP_CALL_DEFAULT_VOLUME) / GROUP_CALL_VOLUME_MULTIPLIER).toString();\n}\n","import type { GroupCallParticipant } from '../../../lib/secret-sauce';\nimport { THRESHOLD } from '../../../lib/secret-sauce';\nimport type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../lib/teact/teact';\n\nimport { LOCAL_TGS_URLS } from '../../common/helpers/animatedAssets';\nimport usePrevious from '../../../hooks/usePrevious';\n\nimport AnimatedIcon from '../../common/AnimatedIcon';\n\ntype OwnProps = {\n  participant: GroupCallParticipant;\n  noColor?: boolean;\n  className?: string;\n};\n\nconst OutlinedMicrophoneIcon: FC<OwnProps> = ({\n  participant,\n  noColor,\n  className,\n}) => {\n  const { isMuted, isMutedByMe } = participant;\n  const isSpeaking = (participant.amplitude || 0) > THRESHOLD;\n  const isRaiseHand = Boolean(participant.raiseHandRating);\n  const prevIsRaiseHand = usePrevious(isRaiseHand);\n  const canSelfUnmute = Boolean(participant?.canSelfUnmute);\n  const shouldRaiseHand = !canSelfUnmute && isMuted;\n  const prevIsMuted = usePrevious(isMuted);\n\n  const playSegment: [number, number] = useMemo(() => {\n    if (isMuted && !prevIsMuted) {\n      return [43, 64];\n    }\n\n    if (!isMuted && prevIsMuted) {\n      return [22, 42];\n    }\n\n    if (isRaiseHand && !prevIsRaiseHand) {\n      return [65, 84];\n    }\n\n    if (!shouldRaiseHand && prevIsRaiseHand) {\n      return [0, 21];\n    }\n\n    // TODO cancel request to speak should play in reverse\n    // if (!isRaiseHand && prevIsRaiseHand) {\n    //   return [84, 65];\n    // }\n\n    return isMuted ? [22, 23] : [43, 44];\n    // eslint-disable-next-line\n  }, [isMuted, shouldRaiseHand, isRaiseHand]);\n\n  const microphoneColor: string = useMemo(() => {\n    if (noColor) {\n      return '#ffffff';\n    }\n\n    if (isRaiseHand) {\n      return '#4da6e0';\n    }\n\n    if (shouldRaiseHand || isMutedByMe) {\n      return '#ff706f';\n    }\n\n    if (isSpeaking) {\n      return '#57bc6c';\n    }\n\n    return '#aaaaaa';\n  }, [noColor, isRaiseHand, shouldRaiseHand, isMutedByMe, isSpeaking]);\n\n  return (\n    <AnimatedIcon\n      tgsUrl={LOCAL_TGS_URLS.VoiceOutlined}\n      play={playSegment.toString()}\n      playSegment={playSegment}\n      size={28}\n      color={microphoneColor}\n      className={className}\n      forceOnHeavyAnimation\n      forceInBackground\n      nonInteractive\n    />\n  );\n};\n\nexport default memo(OutlinedMicrophoneIcon);\n","import type { GroupCallParticipant } from '../../../lib/secret-sauce';\nimport type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useEffect, useState,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport { GROUP_CALL_DEFAULT_VOLUME, GROUP_CALL_VOLUME_MULTIPLIER } from '../../../config';\nimport { LOCAL_TGS_URLS } from '../../common/helpers/animatedAssets';\nimport buildClassName from '../../../util/buildClassName';\nimport useRunThrottled from '../../../hooks/useRunThrottled';\nimport useFlag from '../../../hooks/useFlag';\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport { selectIsAdminInActiveGroupCall } from '../../../global/selectors/calls';\n\nimport Menu from '../../ui/Menu';\nimport MenuItem from '../../ui/MenuItem';\nimport AnimatedIcon from '../../common/AnimatedIcon';\nimport DeleteMemberModal from '../../right/DeleteMemberModal';\n\nimport './GroupCallParticipantMenu.scss';\n\nconst SPEAKER_ICON_DISABLED_SEGMENT: [number, number] = [0, 17];\nconst SPEAKER_ICON_ENABLED_SEGMENT: [number, number] = [17, 34];\n\ntype OwnProps = {\n  participant?: GroupCallParticipant;\n  onCloseAnimationEnd: VoidFunction;\n  onClose: VoidFunction;\n  isDropdownOpen: boolean;\n  positionX?: 'left' | 'right';\n  positionY?: 'top' | 'bottom';\n  transformOriginX?: number;\n  transformOriginY?: number;\n  style?: string;\n  menuRef?: React.RefObject<HTMLDivElement>;\n};\n\ntype StateProps = {\n  isAdmin: boolean;\n};\n\nconst VOLUME_ZERO = 0;\nconst VOLUME_LOW = 50;\nconst VOLUME_MEDIUM = 100;\nconst VOLUME_NORMAL = 150;\n\nconst VOLUME_CHANGE_THROTTLE = 500;\n\nconst SPEAKER_ICON_SIZE = 24;\n\nconst GroupCallParticipantMenu: FC<OwnProps & StateProps> = ({\n  participant,\n  onCloseAnimationEnd,\n  onClose,\n  isDropdownOpen,\n  isAdmin,\n  positionY,\n  menuRef,\n  positionX,\n  style,\n  transformOriginY,\n  transformOriginX,\n}) => {\n  const {\n    toggleGroupCallMute,\n    setGroupCallParticipantVolume,\n    toggleGroupCallPanel,\n    openChat,\n    requestToSpeak,\n  } = getActions();\n\n  const lang = useLang();\n  const [isDeleteUserModalOpen, openDeleteUserModal, closeDeleteUserModal] = useFlag();\n\n  const id = participant?.id;\n  const {\n    isMutedByMe, isMuted, isSelf, canSelfUnmute,\n  } = participant || {};\n  const isRaiseHand = Boolean(participant?.raiseHandRating);\n  const shouldRaiseHand = !canSelfUnmute && isMuted;\n\n  const [localVolume, setLocalVolume] = useState(\n    isMutedByMe ? VOLUME_ZERO : ((participant?.volume || GROUP_CALL_DEFAULT_VOLUME) / GROUP_CALL_VOLUME_MULTIPLIER),\n  );\n\n  const [shouldPlay, setShouldPlay] = useState(false);\n\n  const isLocalVolumeZero = localVolume === VOLUME_ZERO;\n  const speakerIconPlaySegment = isLocalVolumeZero ? SPEAKER_ICON_DISABLED_SEGMENT : SPEAKER_ICON_ENABLED_SEGMENT;\n\n  useEffect(() => {\n    if (isDropdownOpen) return;\n    setShouldPlay(false);\n  }, [isDropdownOpen]);\n\n  const handleSetLocalVolume = useLastCallback((volume: number) => {\n    setLocalVolume(volume);\n    const isNewLocalVolumeZero = volume === VOLUME_ZERO;\n    setShouldPlay(isNewLocalVolumeZero !== isLocalVolumeZero);\n  });\n\n  useEffect(() => {\n    setLocalVolume(isMutedByMe\n      ? VOLUME_ZERO\n      : ((participant?.volume || GROUP_CALL_DEFAULT_VOLUME) / GROUP_CALL_VOLUME_MULTIPLIER));\n    // We only want to initialize local volume when switching participants and ignore following updates from server\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, [id]);\n\n  const runThrottled = useRunThrottled(VOLUME_CHANGE_THROTTLE);\n\n  const handleRemove = useLastCallback((e: React.SyntheticEvent<any>) => {\n    e.stopPropagation();\n    openDeleteUserModal();\n    onClose();\n  });\n\n  const handleCancelRequestToSpeak = useLastCallback((e: React.SyntheticEvent<any>) => {\n    e.stopPropagation();\n    requestToSpeak({\n      value: false,\n    });\n    onClose();\n  });\n\n  const handleMute = useLastCallback((e: React.SyntheticEvent<any>) => {\n    e.stopPropagation();\n    onClose();\n\n    if (!isAdmin) {\n      handleSetLocalVolume(isMutedByMe ? GROUP_CALL_DEFAULT_VOLUME / GROUP_CALL_VOLUME_MULTIPLIER : VOLUME_ZERO);\n    } else if (shouldRaiseHand) {\n      handleSetLocalVolume((participant?.volume ?? GROUP_CALL_DEFAULT_VOLUME) / GROUP_CALL_VOLUME_MULTIPLIER);\n    }\n\n    toggleGroupCallMute({\n      participantId: id!,\n      value: isAdmin ? !shouldRaiseHand : !isMutedByMe,\n    });\n  });\n\n  const handleOpenProfile = useLastCallback((e: React.SyntheticEvent<any>) => {\n    e.stopPropagation();\n    toggleGroupCallPanel();\n    openChat({\n      id,\n    });\n    onClose();\n  });\n\n  const handleChangeVolume = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = Number(e.target.value);\n    handleSetLocalVolume(value);\n\n    runThrottled(() => {\n      if (value === VOLUME_ZERO) {\n        toggleGroupCallMute({\n          participantId: id!,\n          value: true,\n        });\n      } else {\n        setGroupCallParticipantVolume({\n          participantId: id!,\n          volume: Math.floor(value * GROUP_CALL_VOLUME_MULTIPLIER),\n        });\n      }\n    });\n  };\n\n  return (\n    <div>\n      <Menu\n        isOpen={isDropdownOpen}\n        positionX={positionX}\n        positionY={positionY}\n        transformOriginX={transformOriginX}\n        transformOriginY={transformOriginY}\n        style={style}\n        ref={menuRef}\n        withPortal\n        onClose={onClose}\n        onCloseAnimationEnd={onCloseAnimationEnd}\n        className=\"participant-menu with-menu-transitions\"\n      >\n        {!isSelf && !shouldRaiseHand && (\n          <div className=\"group\">\n            <div className={buildClassName(\n              'volume-control',\n              localVolume < VOLUME_LOW && 'low',\n              localVolume >= VOLUME_LOW && localVolume < VOLUME_MEDIUM && 'medium',\n              localVolume >= VOLUME_MEDIUM && localVolume < VOLUME_NORMAL && 'normal',\n              localVolume >= VOLUME_NORMAL && 'high',\n            )}\n            >\n              <input\n                type=\"range\"\n                min=\"0\"\n                max=\"200\"\n                value={localVolume}\n                onChange={handleChangeVolume}\n              />\n              <div className=\"info\">\n                <AnimatedIcon\n                  tgsUrl={LOCAL_TGS_URLS.Speaker}\n                  play={shouldPlay ? speakerIconPlaySegment.toString() : false}\n                  playSegment={speakerIconPlaySegment}\n                  size={SPEAKER_ICON_SIZE}\n                />\n                <span>{localVolume}%</span>\n              </div>\n            </div>\n          </div>\n        )}\n        <div className=\"group\">\n          {(isRaiseHand && isSelf) && (\n            <MenuItem\n              icon=\"stop-raising-hand\"\n              onClick={handleCancelRequestToSpeak}\n            >\n              {lang('VoipGroupCancelRaiseHand')}\n            </MenuItem>\n          )}\n          {!isSelf && <MenuItem icon=\"user\" onClick={handleOpenProfile}>{lang('VoipGroupOpenProfile')}</MenuItem>}\n          {!isSelf && (\n            // TODO cross mic\n            <MenuItem\n              icon={isMuted ? (isAdmin && shouldRaiseHand ? 'allow-speak' : 'microphone-alt') : 'microphone-alt'}\n              onClick={handleMute}\n            >\n              {isAdmin\n                ? lang(shouldRaiseHand ? 'VoipGroupAllowToSpeak' : 'VoipMute')\n                : lang(isMutedByMe ? 'VoipGroupUnmuteForMe' : 'VoipGroupMuteForMe')}\n            </MenuItem>\n          )}\n          {!isSelf && isAdmin && (\n            // TODO replace with hand\n            <MenuItem icon=\"delete-user\" destructive onClick={handleRemove}>\n              {lang('VoipGroupUserRemove')}\n            </MenuItem>\n          )}\n        </div>\n      </Menu>\n\n      {!isSelf && isAdmin && (\n        <DeleteMemberModal\n          isOpen={isDeleteUserModalOpen}\n          userId={id}\n          onClose={closeDeleteUserModal}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    return {\n      isAdmin: selectIsAdminInActiveGroupCall(global),\n    };\n  },\n)(GroupCallParticipantMenu));\n","import useThrottledCallback from './useThrottledCallback';\n\nexport default function useRunThrottled(ms: number, noFirst?: boolean, deps: any = []) {\n  return useThrottledCallback((cb: NoneToVoidFunction) => {\n    cb();\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, deps, ms, noFirst);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"YtzOv_YJhE1p3qIWbAwu\",\"subtitle\":\"d_IXv97OWeVU1anCLIJV\",\"subtitleText\":\"hL5wQ6wC2WbM7bmQW7eY\",\"icon\":\"LK6KFK0AcvforsfYGu1Z\",\"subtitleBlue\":\"q12ZkFJeUiQJmHmb1R9r\",\"subtitleRed\":\"xq8TrzM7pkLCcJpb_2Mu\",\"subtitleGreen\":\"IFhZNdfzczQYrCk5lEEo\",\"avatar\":\"_B2_m9csWv9ZGwlDIpPc\"};","import type { GroupCallParticipant as TypeGroupCallParticipant } from '../../../lib/secret-sauce';\nimport { THRESHOLD } from '../../../lib/secret-sauce';\nimport type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useMemo, useRef,\n} from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../global';\n\nimport type { ApiChat, ApiUser } from '../../../api/types';\n\nimport { GROUP_CALL_DEFAULT_VOLUME } from '../../../config';\nimport buildClassName from '../../../util/buildClassName';\nimport renderText from '../../common/helpers/renderText';\nimport { selectChat, selectUser } from '../../../global/selectors';\nimport formatGroupCallVolume from './helpers/formatGroupCallVolume';\n\nimport useLang from '../../../hooks/useLang';\nimport useContextMenuHandlers from '../../../hooks/useContextMenuHandlers';\nimport useMenuPosition from '../../../hooks/useMenuPosition';\n\nimport Avatar from '../../common/Avatar';\nimport OutlinedMicrophoneIcon from './OutlinedMicrophoneIcon';\nimport ListItem from '../../ui/ListItem';\nimport GroupCallParticipantMenu from './GroupCallParticipantMenu';\nimport FullNameTitle from '../../common/FullNameTitle';\n\nimport styles from './GroupCallParticipant.module.scss';\n\ntype OwnProps = {\n  participant: TypeGroupCallParticipant;\n};\n\ntype StateProps = {\n  peer?: ApiUser | ApiChat;\n};\n\nconst GroupCallParticipant: FC<OwnProps & StateProps> = ({\n  participant,\n  peer,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const menuRef = useRef<HTMLDivElement>(null);\n  const lang = useLang();\n\n  const {\n    isSelf, isMutedByMe, isMuted, hasVideoStream, hasPresentationStream,\n  } = participant;\n  const isSpeaking = (participant.amplitude || 0) > THRESHOLD;\n  const isRaiseHand = Boolean(participant.raiseHandRating);\n\n  const {\n    isContextMenuOpen,\n    contextMenuPosition,\n    handleContextMenu,\n    handleBeforeContextMenu,\n    handleContextMenuClose,\n    handleContextMenuHide,\n  } = useContextMenuHandlers(ref, isSelf);\n\n  const getTriggerElement = useCallback(() => ref.current, []);\n\n  const getRootElement = useCallback(\n    () => ref.current!.closest('.custom-scroll, .no-scrollbar'),\n    [],\n  );\n\n  const getMenuElement = useCallback(\n    () => menuRef.current!,\n    [],\n  );\n\n  const getLayout = useCallback(\n    () => ({ withPortal: true }),\n    [],\n  );\n\n  const {\n    positionX, positionY, transformOriginX, transformOriginY, style: menuStyle,\n  } = useMenuPosition(\n    contextMenuPosition,\n    getTriggerElement,\n    getRootElement,\n    getMenuElement,\n    getLayout,\n  );\n\n  const hasCustomVolume = Boolean(\n    !isMuted && isSpeaking && participant.volume && participant.volume !== GROUP_CALL_DEFAULT_VOLUME,\n  );\n\n  const [aboutText, aboutColor] = useMemo(() => {\n    if (isMutedByMe) {\n      return [lang('VoipGroupMutedForMe'), styles.subtitleRed];\n    }\n\n    if (isRaiseHand) {\n      return [lang('WantsToSpeak'), styles.subtitleBlue];\n    }\n\n    if (hasCustomVolume) {\n      return [\n        lang('SpeakingWithVolume', formatGroupCallVolume(participant))\n          .replace('%%', '%'),\n        styles.subtitleGreen,\n      ];\n    }\n\n    if (!isMuted && isSpeaking) {\n      return [\n        lang('Speaking'),\n        styles.subtitleGreen,\n      ];\n    }\n\n    if (isSelf) {\n      return [lang('ThisIsYou'), styles.subtitleBlue];\n    }\n\n    return participant.about ? [participant.about, ''] : [lang('Listening'), styles.subtitleBlue];\n  }, [isMutedByMe, isRaiseHand, hasCustomVolume, isMuted, isSpeaking, isSelf, participant, lang]);\n\n  if (!peer) {\n    return undefined;\n  }\n\n  return (\n    <ListItem\n      leftElement={<Avatar peer={peer} className={styles.avatar} />}\n      rightElement={<OutlinedMicrophoneIcon participant={participant} className={styles.icon} />}\n      className={styles.root}\n      onClick={handleContextMenu}\n      onMouseDown={handleBeforeContextMenu}\n      onContextMenu={handleContextMenu}\n      multiline\n      ripple\n      ref={ref}\n    >\n      <FullNameTitle peer={peer} withEmojiStatus className={styles.title} />\n      <span className={buildClassName(styles.subtitle, 'subtitle', aboutColor)}>\n        {hasPresentationStream && <i className=\"icon icon-share-screen\" aria-hidden />}\n        {hasVideoStream && <i className=\"icon icon-video\" aria-hidden />}\n        {hasCustomVolume && <i className=\"icon icon-speaker\" aria-hidden />}\n        <span className={styles.subtitleText}>{renderText(aboutText)}</span>\n      </span>\n      <GroupCallParticipantMenu\n        participant={participant}\n        isDropdownOpen={isContextMenuOpen}\n        positionX={positionX}\n        positionY={positionY}\n        transformOriginX={transformOriginX}\n        transformOriginY={transformOriginY}\n        style={menuStyle}\n        onClose={handleContextMenuClose}\n        onCloseAnimationEnd={handleContextMenuHide}\n        menuRef={menuRef}\n      />\n    </ListItem>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { participant }): StateProps => {\n    return {\n      peer: selectUser(global, participant.id) || selectChat(global, participant.id),\n    };\n  },\n)(GroupCallParticipant));\n","import React, { memo, useMemo } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { GroupCallParticipant as TypeGroupCallParticipant } from '../../../lib/secret-sauce';\nimport type { FC } from '../../../lib/teact/teact';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { selectActiveGroupCall } from '../../../global/selectors/calls';\nimport useInfiniteScroll from '../../../hooks/useInfiniteScroll';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nimport GroupCallParticipant from './GroupCallParticipant';\nimport InfiniteScroll from '../../ui/InfiniteScroll';\n\nimport styles from './GroupCallParticipantList.module.scss';\n\ntype OwnProps = {\n  panelOffset: number;\n  isLandscape: boolean;\n};\n\ntype StateProps = {\n  participantsCount: number;\n  participants?: Record<string, TypeGroupCallParticipant>;\n  canInvite?: boolean;\n};\n\nconst GroupCallParticipantList: FC<OwnProps & StateProps> = ({\n  panelOffset,\n  participants,\n  participantsCount,\n  isLandscape,\n}) => {\n  const {\n    loadMoreGroupCallParticipants,\n  } = getActions();\n\n  const orderedParticipantIds = useMemo(() => {\n    return Object.values(participants || {}).sort(compareParticipants).map((participant) => participant.id);\n  }, [participants]);\n\n  const handleLoadMoreGroupCallParticipants = useLastCallback(() => {\n    loadMoreGroupCallParticipants();\n  });\n\n  const [viewportIds, getMore] = useInfiniteScroll(\n    handleLoadMoreGroupCallParticipants,\n    orderedParticipantIds,\n    orderedParticipantIds.length >= participantsCount,\n  );\n\n  return (\n    <InfiniteScroll\n      items={viewportIds}\n      onLoadMore={getMore}\n      style={`transform: translateY(${panelOffset}px);`}\n      className={buildClassName(styles.root, !isLandscape && styles.portrait)}\n    >\n      {participants && viewportIds?.map(\n        (participantId) => (\n          participants[participantId] && (\n            <GroupCallParticipant\n              key={participantId}\n              teactOrderKey={orderedParticipantIds.indexOf(participantId)}\n              participant={participants[participantId]}\n            />\n          )\n        ),\n      )}\n    </InfiniteScroll>\n  );\n};\n\nfunction compareFields<T>(a: T, b: T) {\n  return Number(b) - Number(a);\n}\n\nfunction compareParticipants(a: TypeGroupCallParticipant, b: TypeGroupCallParticipant) {\n  return compareFields(!a.isMuted, !b.isMuted)\n        || compareFields(a.presentation, b.presentation)\n        || compareFields(a.video, b.video)\n        || compareFields(a.raiseHandRating, b.raiseHandRating);\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    const { participantsCount, participants } = selectActiveGroupCall(global) || {};\n\n    return {\n      participants,\n      participantsCount: participantsCount || 0,\n    };\n  },\n)(GroupCallParticipantList));\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"MaXJ6PbnczgUaXKytU26\",\"portrait\":\"KDT2Zfq3ho5J3_CUMqK2\"};","// extracted by mini-css-extract-plugin\nexport default {\"wrapper\":\"VowYvAYnpOoRyvJApJQx\",\"hidden\":\"rhyIpeB0s5L9Rmgi17tE\",\"noAnimate\":\"YdJNWDXWUzCFMWFDHCB1\",\"root\":\"T3WHHUMTxj1TjHVdEQEg\",\"speaking\":\"yB5xApXNfpH_uWMlaJ_v\",\"loader\":\"hjZk9WRq4TrqMCq3E2y8\",\"video\":\"Yr9Loz5dybqTYl1YGWPC\",\"videoFallback\":\"TTT3HkSjEHudE0V0mbIS Yr9Loz5dybqTYl1YGWPC\",\"thumbnailWrapper\":\"JGuT5GiXuGEeFNyc_SyE\",\"thumbnail\":\"aGXmhcH9sptqhStorby8\",\"flipped\":\"tZLFA5gL8kShE0_r8Xwb\",\"pinButton\":\"loYfROdAEWBH4mFbwlew\",\"bottomPanel\":\"TipRbLLEOnRQN7eDzIlX\",\"info\":\"TRFmGn5RJRcHhQSXUkg8\",\"pinned\":\"OyzsHbgzvjeEUTE090PB\",\"name\":\"xjevYlbKT3orz6OwaJTN\",\"status\":\"VNKqmM8nVTBnQLg84tVQ\",\"icon\":\"FhEGCqYjf67Tz1J54Nf7\"};","import React, {\n  memo, useCallback, useEffect, useMemo, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../global';\n\nimport type { FC } from '../../../lib/teact/teact';\nimport type { VideoLayout, VideoParticipant } from './hooks/useGroupCallVideoLayout';\nimport type { GroupCallParticipant as TypeGroupCallParticipant } from '../../../lib/secret-sauce';\nimport type { ApiChat, ApiUser } from '../../../api/types';\n\nimport { IS_CANVAS_FILTER_SUPPORTED } from '../../../util/windowEnvironment';\nimport { GROUP_CALL_DEFAULT_VOLUME } from '../../../config';\nimport { getUserStreams, THRESHOLD } from '../../../lib/secret-sauce';\nimport buildClassName from '../../../util/buildClassName';\nimport { selectChat, selectUser } from '../../../global/selectors';\nimport { animate } from '../../../util/animation';\nimport { fastRaf } from '../../../util/schedulers';\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport formatGroupCallVolume from './helpers/formatGroupCallVolume';\nimport fastBlur from '../../../lib/fastBlur';\n\nimport useLang from '../../../hooks/useLang';\nimport useContextMenuHandlers from '../../../hooks/useContextMenuHandlers';\nimport useMenuPosition from '../../../hooks/useMenuPosition';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useInterval from '../../../hooks/useInterval';\n\nimport Button from '../../ui/Button';\nimport OutlinedMicrophoneIcon from './OutlinedMicrophoneIcon';\nimport FullNameTitle from '../../common/FullNameTitle';\nimport GroupCallParticipantMenu from './GroupCallParticipantMenu';\nimport Skeleton from '../../ui/Skeleton';\n\nimport styles from './GroupCallParticipantVideo.module.scss';\n\nconst BLUR_RADIUS = 2;\nconst BLUR_ITERATIONS = 2;\nconst VIDEO_FALLBACK_UPDATE_INTERVAL = 1000;\n\ntype OwnProps = {\n  layout: VideoLayout;\n  setPinned: (participant?: VideoParticipant) => void;\n  pinnedVideo: VideoParticipant | undefined;\n  canPin: boolean;\n  participant: TypeGroupCallParticipant;\n  className?: string;\n};\n\ntype StateProps = {\n  user?: ApiUser;\n  chat?: ApiChat;\n};\n\nconst GroupCallParticipantVideo: FC<OwnProps & StateProps> = ({\n  layout,\n  pinnedVideo,\n  setPinned,\n  canPin,\n  className,\n  participant,\n  user,\n  chat,\n}) => {\n  const lang = useLang();\n\n  // eslint-disable-next-line no-null/no-null\n  const thumbnailRef = useRef<HTMLCanvasElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const videoRef = useRef<HTMLVideoElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const videoFallbackRef = useRef<HTMLCanvasElement>(null);\n\n  const {\n    x, y, width, height, noAnimate, isRemoved,\n    type,\n  } = layout;\n  const {\n    isSelf, isMutedByMe, isMuted,\n  } = participant;\n  const isPinned = pinnedVideo?.id === participant.id && pinnedVideo?.type === type;\n  const isSpeaking = (participant.amplitude || 0) > THRESHOLD;\n  const isRaiseHand = Boolean(participant.raiseHandRating);\n  const shouldFlipVideo = type === 'video' && participant.isSelf;\n\n  const status = useMemo(() => {\n    if (isSelf) {\n      return lang('ThisIsYou');\n    }\n\n    if (isMutedByMe) {\n      return lang('VoipGroupMutedForMe');\n    }\n\n    if (isRaiseHand) {\n      return lang('WantsToSpeak');\n    }\n\n    if (isMuted || !isSpeaking) {\n      return lang('Listening');\n    }\n\n    if (participant.volume && participant.volume !== GROUP_CALL_DEFAULT_VOLUME) {\n      return lang('SpeakingWithVolume', formatGroupCallVolume(participant))\n        .replace('%%', '%');\n    }\n\n    return lang('Speaking');\n  }, [isSelf, isMutedByMe, isRaiseHand, isMuted, isSpeaking, participant, lang]);\n\n  const prevLayoutRef = useRef<VideoLayout>();\n  if (!isRemoved) {\n    prevLayoutRef.current = layout;\n  }\n  const {\n    x: prevX, y: prevY, width: prevWidth, height: prevHeight,\n  } = prevLayoutRef.current || {};\n\n  const [currentX, currentY, currentWidth, currentHeight] = isRemoved\n    ? [prevX, prevY, prevWidth, prevHeight] : [x, y, width, height];\n\n  const [isHidden, setIsHidden] = useState(!noAnimate);\n\n  const streams = getUserStreams(user?.id || chat!.id);\n  const actualStream = type === 'video' ? streams?.video : streams?.presentation;\n  const streamRef = useRef(actualStream);\n  if (actualStream?.active && actualStream?.getVideoTracks()[0].enabled) {\n    streamRef.current = actualStream;\n  }\n  const stream = streamRef.current;\n\n  const handleInactive = useLastCallback(() => {\n    const video = videoRef.current;\n    if (!video) return;\n    // eslint-disable-next-line no-null/no-null\n    video.srcObject = null;\n  });\n\n  useEffect(() => {\n    stream?.addEventListener('inactive', handleInactive);\n    return () => {\n      stream?.removeEventListener('inactive', handleInactive);\n    };\n  }, [handleInactive, stream]);\n\n  useEffect(() => {\n    setIsHidden(false);\n  }, []);\n\n  const [isLoading, setIsLoading] = useState(true);\n\n  const handleCanPlay = useLastCallback(() => {\n    setIsLoading(false);\n  });\n\n  // When video stream is removed, the video element starts showing empty black screen.\n  // To avoid that, we hide the video element and show the fallback frame instead, which is constantly updated\n  // every VIDEO_FALLBACK_UPDATE_INTERVAL milliseconds.\n  useInterval(() => {\n    if (!stream?.active) return;\n    const video = videoRef.current!;\n    const canvas = videoFallbackRef.current!;\n\n    requestMutation(() => {\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      canvas.getContext('2d')!.drawImage(video, 0, 0, canvas.width, canvas.height);\n    });\n  }, VIDEO_FALLBACK_UPDATE_INTERVAL);\n\n  useEffect(() => {\n    const video = videoRef.current;\n    const thumbnail = thumbnailRef.current;\n    if (!video || !thumbnail || !stream) return undefined;\n\n    const ctx = thumbnail.getContext('2d', { alpha: false });\n    if (!ctx) return undefined;\n\n    let isDrawing = true;\n    requestMutation(() => {\n      if (!isDrawing) return;\n      thumbnail.width = 16;\n      thumbnail.height = 16;\n      ctx.filter = 'blur(2px)';\n\n      const draw = () => {\n        if (!isDrawing) return false;\n        if (!stream.active) {\n          return false;\n        }\n        ctx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, thumbnail.width, thumbnail.height);\n        if (!IS_CANVAS_FILTER_SUPPORTED) {\n          fastBlur(ctx, 0, 0, thumbnail.width, thumbnail.height, BLUR_RADIUS, BLUR_ITERATIONS);\n        }\n        return true;\n      };\n\n      animate(draw, fastRaf);\n    });\n\n    return () => {\n      isDrawing = false;\n    };\n  }, [stream]);\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  const {\n    isContextMenuOpen,\n    contextMenuPosition,\n    handleContextMenu,\n    handleContextMenuClose,\n    handleContextMenuHide,\n  } = useContextMenuHandlers(ref, isSelf);\n\n  const getTriggerElement = useCallback(() => ref.current, []);\n\n  const getRootElement = useCallback(\n    () => ref.current!.closest('.custom-scroll, .no-scrollbar'),\n    [],\n  );\n\n  const getMenuElement = useCallback(\n    () => menuRef.current!,\n    [],\n  );\n\n  const getLayout = useCallback(\n    () => ({ withPortal: true }),\n    [],\n  );\n\n  const {\n    positionX, positionY, transformOriginX, transformOriginY, style: menuStyle,\n  } = useMenuPosition(\n    contextMenuPosition,\n    getTriggerElement,\n    getRootElement,\n    getMenuElement,\n    getLayout,\n  );\n\n  const handleClickPin = useCallback(() => {\n    setPinned(!isPinned ? {\n      id: user?.id || chat!.id,\n      type,\n    } : undefined);\n  }, [chat, isPinned, setPinned, type, user?.id]);\n\n  return (\n    <div\n      className={buildClassName(\n        styles.wrapper,\n        (isHidden || isRemoved) && styles.hidden,\n        noAnimate && styles.noAnimate,\n        className,\n        isPinned && styles.pinned,\n      )}\n      style={`--x: ${currentX}px; --y: ${currentY}px; --width: ${currentWidth}px; --height: ${currentHeight}px;`}\n      ref={ref}\n      onContextMenu={handleContextMenu}\n      onDoubleClick={canPin ? handleClickPin : undefined}\n    >\n      <div\n        className={buildClassName(\n          styles.root,\n          isSpeaking && styles.speaking,\n        )}\n      >\n        {isLoading && (\n          <Skeleton className={buildClassName(styles.video, styles.loader)} />\n        )}\n        {stream && (\n          <video\n            className={buildClassName(styles.video, shouldFlipVideo && styles.flipped)}\n            muted\n            autoPlay\n            playsInline\n            srcObject={stream}\n            ref={videoRef}\n            onCanPlay={handleCanPlay}\n          />\n        )}\n        <canvas\n          className={buildClassName(styles.videoFallback, shouldFlipVideo && styles.flipped)}\n          ref={videoFallbackRef}\n        />\n        <div className={styles.thumbnailWrapper}>\n          <canvas\n            className={buildClassName(styles.thumbnail, shouldFlipVideo && styles.flipped)}\n            ref={thumbnailRef}\n          />\n        </div>\n        {canPin && (\n          <Button\n            round\n            size=\"smaller\"\n            ripple\n            color=\"translucent\"\n            className={styles.pinButton}\n            ariaLabel={lang(isPinned ? 'lng_group_call_context_unpin_camera' : 'lng_group_call_context_pin_camera')}\n            onClick={handleClickPin}\n          >\n            <i className={buildClassName('icon', isPinned ? 'icon-unpin' : 'icon-pin')} />\n          </Button>\n        )}\n        <div className={styles.bottomPanel}>\n          <div className={styles.info}>\n            <FullNameTitle peer={user || chat!} className={styles.name} />\n            <div className={styles.status}>{status}</div>\n          </div>\n          <OutlinedMicrophoneIcon participant={participant} className={styles.icon} noColor />\n        </div>\n      </div>\n\n      <GroupCallParticipantMenu\n        participant={participant}\n        isDropdownOpen={isContextMenuOpen}\n        positionX={positionX}\n        positionY={positionY}\n        transformOriginX={transformOriginX}\n        transformOriginY={transformOriginY}\n        style={menuStyle}\n        onClose={handleContextMenuClose}\n        onCloseAnimationEnd={handleContextMenuHide}\n        menuRef={menuRef}\n      />\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { participant }): StateProps => {\n    return {\n      user: participant.isUser ? selectUser(global, participant.id) : undefined,\n      chat: !participant.isUser ? selectChat(global, participant.id) : undefined,\n    };\n  },\n)(GroupCallParticipantVideo));\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"fyUCcatntsTa_YkVpZCR\",\"panelWrapper\":\"b3jsxTWWaVRz5PgjlLVf\",\"panel\":\"XzyFw6Jv2_ezVQGIqawU\",\"panelScrollTrigger\":\"V7wA8W8hNoCcBKHxf4hT\",\"panelHeader\":\"t6Om0WIUsRLLZV9Cc0KJ\",\"scrolled\":\"kGj_uhd6vwlqYp7AYUcx\",\"fullscreen\":\"GnCdvyLEoJLuYpmgt4Ss\",\"landscape\":\"gR_aXfrHQVIxdqlD7Kzc\",\"headerButton\":\"obtrrwNt6GBLqhM9oFmm\",\"firstButton\":\"zpgyOLRxhZgDHkFynsU0\",\"lastButton\":\"o0dIwExEv0BpVIQOsDnM\",\"panelHeaderText\":\"UMJnOojFmrqTKlWMo8aG\",\"title\":\"AcV4YuEJQsio2Y1mb8NI\",\"bigger\":\"KzSCbnCRFSRjnjNvs7DO\",\"subtitle\":\"w7hs8dy7SXtq4hoRdA7v\",\"participants\":\"HzQTDfEVKQFHpKBBL2Xk\",\"participantVideos\":\"ediyUOQamD3wqwyt1OHn\",\"addParticipantButton\":\"LrlxHbsK4nR40UwUT9tK\",\"videos\":\"V06H2v7o5yKYh54ZUkAW\",\"mainVideoContainer\":\"xYluQGqciLtWwKbroLFE\",\"videosHeader\":\"ILuaK6cG99MeCGr9DNiI\",\"videosHeaderLastButton\":\"FRWFfGWGqAfcIaiYI43I\",\"videosContent\":\"hZ3hHp1KVhCV8WLZTQzu\",\"actions\":\"IlgtQK0Z99LuWgmiCmpc\",\"actionButton\":\"iX69gJg2DcXiCjcn7Z9_\",\"destructive\":\"BDXZ55Nvs0ov0_K2MCvR\",\"canRequestToSpeak\":\"uvqh2N80Lk6ZMNN3rc1A\",\"muted\":\"tuWi4pcqOQX8sfdvlCaN\",\"portrait\":\"WnKR5AT56cbE5LSxbJoa\",\"noVideoParticipants\":\"JO8y1VdvKW0gKzSQXQh0\",\"noSidebar\":\"yiyRELlSa8Nyrn_onUsb\"};","import React, {\n  memo, useEffect, useMemo, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\nimport '../../../global/actions/calls';\n\nimport type {\n  GroupCallConnectionState, GroupCallParticipant as TypeGroupCallParticipant,\n} from '../../../lib/secret-sauce';\nimport type { FC } from '../../../lib/teact/teact';\nimport type { VideoParticipant } from './hooks/useGroupCallVideoLayout';\n\nimport { IS_SCREENSHARE_SUPPORTED } from '../../../lib/secret-sauce';\nimport buildClassName from '../../../util/buildClassName';\nimport {\n  selectCanInviteToActiveGroupCall,\n  selectGroupCall,\n  selectGroupCallParticipant,\n  selectIsAdminInActiveGroupCall,\n} from '../../../global/selectors/calls';\nimport { selectChat, selectTabState } from '../../../global/selectors';\nimport { compact } from '../../../util/iteratees';\nimport useFlag from '../../../hooks/useFlag';\nimport useLang from '../../../hooks/useLang';\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useGroupCallVideoLayout from './hooks/useGroupCallVideoLayout';\nimport { useIntersectionObserver, useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nimport Button from '../../ui/Button';\nimport Modal from '../../ui/Modal';\nimport MicrophoneButton from './MicrophoneButton';\nimport Checkbox from '../../ui/Checkbox';\nimport GroupCallParticipantList from './GroupCallParticipantList';\nimport FloatingActionButton from '../../ui/FloatingActionButton';\nimport GroupCallParticipantVideo from './GroupCallParticipantVideo';\n\nimport styles from './GroupCall.module.scss';\n\nconst INTERSECTION_THROTTLE = 200;\n\nexport type OwnProps = {\n  groupCallId: string;\n};\n\ntype StateProps = {\n  isCallPanelVisible: boolean;\n  connectionState: GroupCallConnectionState;\n  title?: string;\n  meParticipant?: TypeGroupCallParticipant;\n  participantsCount?: number;\n  isAdmin: boolean;\n  participants: Record<string, TypeGroupCallParticipant>;\n  canInvite: boolean;\n};\n\nconst GroupCall: FC<OwnProps & StateProps> = ({\n  groupCallId,\n  isCallPanelVisible,\n  connectionState,\n  participantsCount,\n  title,\n  meParticipant,\n  isAdmin,\n  participants,\n  canInvite,\n}) => {\n  const {\n    toggleGroupCallVideo,\n    toggleGroupCallPresentation,\n    leaveGroupCall,\n    toggleGroupCallPanel,\n    connectToActiveGroupCall,\n    playGroupCallSound,\n    createGroupCallInviteLink,\n  } = getActions();\n\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // eslint-disable-next-line no-null/no-null\n  const primaryVideoContainerRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const secondaryVideoContainerRef = useRef<HTMLDivElement>(null);\n\n  // eslint-disable-next-line no-null/no-null\n  const panelScrollTriggerRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const panelRef = useRef<HTMLDivElement>(null);\n\n  const [isLeaving, setIsLeaving] = useState(false);\n  const isOpen = !isCallPanelVisible && !isLeaving;\n\n  const { observe } = useIntersectionObserver({\n    rootRef: panelRef,\n    throttleMs: INTERSECTION_THROTTLE,\n    isDisabled: !isOpen,\n  });\n\n  const hasScrolled = !useIsIntersecting(panelScrollTriggerRef, isOpen ? observe : undefined);\n\n  const { isMobile, isLandscape } = useAppLayout();\n\n  const [isFullscreen, openFullscreen, closeFullscreen] = useFlag();\n  const [isSidebarOpen, openSidebar, closeSidebar] = useFlag(true);\n  const isLandscapeLayout = Boolean(isFullscreen && isLandscape);\n\n  const firstPresentation = useMemo(() => {\n    return Object.values(participants).find(({ presentation }) => presentation);\n  }, [participants]);\n  const videoParticipants = useMemo(() => Object.values(participants)\n    .filter(({ video, presentation }) => video || presentation)\n    .flatMap(({ id, video, presentation }) => compact([\n      video ? {\n        id,\n        type: 'video' as const,\n      } : undefined,\n      presentation ? {\n        id,\n        type: 'screen' as const,\n      } : undefined,\n    ])),\n  [participants]);\n  const hasVideoParticipants = videoParticipants.length > 0;\n\n  const groupCallTitle = title || lang('VoipGroupVoiceChat');\n  const membersString = lang('Participants', participantsCount, 'i');\n\n  const [isConfirmLeaveModalOpen, openConfirmLeaveModal, closeConfirmLeaveModal] = useFlag();\n  const [isEndGroupCallModal, setIsEndGroupCallModal] = useState(false);\n  const [shouldEndGroupCall, setShouldEndGroupCall] = useState(false);\n\n  const hasVideo = meParticipant?.hasVideoStream;\n  const hasPresentation = meParticipant?.hasPresentationStream;\n  const hasAudioStream = meParticipant?.hasAudioStream;\n  const isConnecting = connectionState !== 'connected';\n  const canSelfUnmute = meParticipant?.canSelfUnmute;\n  const canRequestToSpeak = !canSelfUnmute && !hasAudioStream;\n\n  useEffect(() => {\n    if (connectionState === 'connected') {\n      playGroupCallSound({ sound: 'join' });\n    } else if (connectionState === 'reconnecting') {\n      playGroupCallSound({ sound: 'connecting' });\n    }\n  }, [connectionState]);\n\n  const handleCloseConfirmLeaveModal = useLastCallback(() => {\n    closeConfirmLeaveModal();\n    setIsEndGroupCallModal(false);\n  });\n\n  const handleToggleFullscreen = useLastCallback(() => {\n    if (!containerRef.current || isMobile) return;\n\n    if (isFullscreen) {\n      closeFullscreen();\n    } else {\n      openFullscreen();\n    }\n  });\n\n  const handleToggleSidebar = useLastCallback(() => {\n    if (isSidebarOpen) {\n      closeSidebar();\n    } else {\n      openSidebar();\n    }\n  });\n\n  const handleToggleGroupCallPanel = useLastCallback(() => {\n    toggleGroupCallPanel();\n  });\n\n  const handleInviteMember = useLastCallback(() => {\n    createGroupCallInviteLink();\n  });\n\n  const handleClickVideo = useLastCallback(() => {\n    toggleGroupCallVideo();\n  });\n\n  useEffect(() => {\n    connectToActiveGroupCall();\n  }, [connectToActiveGroupCall, groupCallId]);\n\n  const handleLeaveGroupCall = useLastCallback(() => {\n    if (isAdmin && !isConfirmLeaveModalOpen) {\n      openConfirmLeaveModal();\n      return;\n    }\n    playGroupCallSound({ sound: 'leave' });\n    setIsLeaving(true);\n    closeConfirmLeaveModal();\n  });\n\n  const handleCloseAnimationEnd = useLastCallback(() => {\n    if (!isLeaving) return;\n\n    leaveGroupCall({\n      shouldDiscard: shouldEndGroupCall,\n    });\n  });\n\n  const handleToggleGroupCallPresentation = useLastCallback(() => {\n    toggleGroupCallPresentation();\n  });\n\n  const canPinVideo = videoParticipants.length > 1 && !isMobile;\n  const isLandscapeWithVideos = isLandscapeLayout && hasVideoParticipants;\n  const [pinnedVideo, setPinnedVideo] = useState<VideoParticipant | undefined>(undefined);\n  const {\n    videoLayout,\n    panelOffset,\n  } = useGroupCallVideoLayout({\n    primaryContainerRef: primaryVideoContainerRef,\n    secondaryContainerRef: secondaryVideoContainerRef,\n    videoParticipants,\n    isLandscapeLayout,\n    pinnedVideo,\n  });\n\n  const handleSetPinnedVideo = useLastCallback((video: VideoParticipant | undefined) => {\n    setPinnedVideo(video);\n    if (video && !isFullscreen) {\n      openFullscreen();\n    }\n  });\n\n  const handleOpenFirstPresentation = useLastCallback(() => {\n    if (!firstPresentation) return;\n\n    setPinnedVideo({\n      id: firstPresentation.id,\n      type: 'screen',\n    });\n  });\n\n  useEffect(handleOpenFirstPresentation, [handleOpenFirstPresentation, Boolean(firstPresentation)]);\n\n  useEffect(() => {\n    if (!pinnedVideo) return;\n    if (!videoParticipants.some((l) => l.type === pinnedVideo.type && l.id === pinnedVideo.id)) {\n      setPinnedVideo(undefined);\n    }\n  }, [pinnedVideo, videoLayout, videoParticipants]);\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={toggleGroupCallPanel}\n      className={buildClassName(\n        styles.root,\n        (isFullscreen || isMobile) && styles.fullscreen,\n        isLandscapeLayout && styles.landscape,\n        !hasVideoParticipants && styles.noVideoParticipants,\n        !isLandscapeLayout && styles.portrait,\n        !isSidebarOpen && isLandscapeWithVideos && styles.noSidebar,\n      )}\n      dialogRef={containerRef}\n      onCloseAnimationEnd={handleCloseAnimationEnd}\n    >\n      {isLandscapeWithVideos && (\n        <div className={styles.videos}>\n          <div className={styles.videosHeader}>\n            {!isMobile && (\n              <Button\n                round\n                size=\"smaller\"\n                color=\"translucent\"\n                onClick={handleToggleFullscreen}\n                className={buildClassName(styles.headerButton, styles.firstButton)}\n                ariaLabel={lang(isFullscreen ? 'AccExitFullscreen' : 'AccSwitchToFullscreen')}\n              >\n                <i\n                  className={buildClassName('icon', isFullscreen ? 'icon-smallscreen' : 'icon-fullscreen')}\n                  aria-hidden\n                />\n              </Button>\n            )}\n\n            <h3 className={buildClassName(styles.title, styles.bigger)}>\n              {title || lang('VoipGroupVoiceChat')}\n            </h3>\n\n            {isLandscapeWithVideos && !isSidebarOpen && (\n              <Button\n                round\n                size=\"smaller\"\n                color=\"translucent\"\n                className={buildClassName(styles.headerButton, styles.videosHeaderLastButton)}\n                onClick={handleToggleSidebar}\n                ariaLabel={lang('AccDescrExpandPanel')}\n              >\n                <i className=\"icon icon-sidebar\" aria-hidden />\n              </Button>\n            )}\n          </div>\n\n          <div\n            className={styles.videosContent}\n            ref={primaryVideoContainerRef}\n          />\n        </div>\n      )}\n\n      <div className={styles.panelWrapper} ref={panelRef}>\n        <div className={buildClassName(styles.panel, 'custom-scroll')}>\n          <div className={styles.panelScrollTrigger} ref={panelScrollTriggerRef} />\n\n          <div className={buildClassName(styles.panelHeader, hasScrolled && styles.scrolled)}>\n            {!isLandscapeWithVideos && !isMobile && (\n              <Button\n                round\n                size=\"smaller\"\n                color=\"translucent\"\n                ripple={!isMobile}\n                className={buildClassName(\n                  styles.firstButton,\n                  styles.headerButton,\n                )}\n                onClick={handleToggleFullscreen}\n                ariaLabel={lang('AccSwitchToFullscreen')}\n              >\n                <i className=\"icon icon-fullscreen\" aria-hidden />\n              </Button>\n            )}\n\n            {isMobile && (\n              <Button\n                round\n                size=\"smaller\"\n                color=\"translucent\"\n                onClick={handleToggleGroupCallPanel}\n                className={buildClassName(styles.headerButton, styles.firstButton)}\n                ariaLabel={lang('Close')}\n              >\n                <i\n                  className={buildClassName('icon', 'icon-close')}\n                  aria-hidden\n                />\n              </Button>\n            )}\n\n            {isLandscapeWithVideos && (\n              <Button\n                round\n                size=\"smaller\"\n                ripple={!isMobile}\n                className={buildClassName(\n                  styles.firstButton,\n                  styles.headerButton,\n                )}\n                color=\"translucent\"\n                onClick={handleToggleSidebar}\n                ariaLabel={lang('AccDescrCollapsePanel')}\n              >\n                <i className=\"icon icon-sidebar\" aria-hidden />\n              </Button>\n            )}\n\n            <div className={styles.panelHeaderText}>\n              <h3 className={buildClassName(styles.title, isLandscapeWithVideos && styles.bigger)}>\n                {isLandscapeWithVideos ? membersString : groupCallTitle}\n              </h3>\n              {!isLandscapeWithVideos && (\n                <span className={styles.subtitle}>\n                  {membersString}\n                </span>\n              )}\n            </div>\n\n            {!isLandscapeWithVideos && canInvite && (\n              <Button\n                round\n                size=\"smaller\"\n                ripple={!isMobile}\n                className={buildClassName(\n                  styles.lastButton,\n                  styles.headerButton,\n                )}\n                color=\"translucent\"\n                onClick={handleInviteMember}\n                ariaLabel={lang('VoipGroupInviteMember')}\n              >\n                <i className=\"icon icon-add-user\" aria-hidden />\n              </Button>\n            )}\n          </div>\n\n          <div className={styles.participants}>\n            <div\n              className={styles.participantVideos}\n              ref={secondaryVideoContainerRef}\n              style={`height: ${panelOffset}px;`}\n            >\n              {videoLayout.map((layout) => {\n                const participant = participants[layout.participantId];\n                if (!layout.isRemounted || !participant) {\n                  return (\n                    <div\n                      teactOrderKey={layout.orderKey}\n                      key={`${layout.participantId}_${layout.type}`}\n                    />\n                  );\n                }\n\n                return (\n                  <GroupCallParticipantVideo\n                    teactOrderKey={layout.orderKey}\n                    key={`${layout.participantId}_${layout.type}`}\n                    layout={layout}\n                    canPin={canPinVideo}\n                    setPinned={handleSetPinnedVideo}\n                    pinnedVideo={pinnedVideo}\n                    participant={participant}\n                  />\n                );\n              })}\n            </div>\n            <GroupCallParticipantList\n              panelOffset={panelOffset}\n              isLandscape={isLandscapeWithVideos}\n            />\n          </div>\n        </div>\n\n        <FloatingActionButton\n          key=\"add-participant\"\n          isShown={isLandscapeWithVideos && canInvite}\n          onClick={handleInviteMember}\n          className={styles.addParticipantButton}\n          ariaLabel={lang('VoipGroupInviteMember')}\n        >\n          <i className=\"icon icon-add-user-filled\" aria-hidden />\n        </FloatingActionButton>\n      </div>\n\n      <div className={styles.mainVideoContainer}>\n        {videoLayout.map((layout) => {\n          const participant = participants[layout.participantId];\n          if (layout.isRemounted || !participant) {\n            return (\n              <div\n                teactOrderKey={layout.orderKey}\n                key={`${layout.participantId}_${layout.type}`}\n              />\n            );\n          }\n          return (\n            <GroupCallParticipantVideo\n              teactOrderKey={layout.orderKey}\n              key={`${layout.participantId}_${layout.type}`}\n              layout={layout}\n              canPin={canPinVideo}\n              setPinned={handleSetPinnedVideo}\n              pinnedVideo={pinnedVideo}\n              participant={participant}\n              className={styles.video}\n            />\n          );\n        })}\n      </div>\n\n      <div className={styles.actions}>\n        <Button\n          round\n          size=\"default\"\n          ripple\n          className={buildClassName(\n            styles.actionButton,\n            !hasAudioStream && styles.muted,\n            canRequestToSpeak && styles.canRequestToSpeak,\n          )}\n          onClick={handleClickVideo}\n          ariaLabel={lang(hasVideo ? 'VoipStopVideo' : 'VoipStartVideo')}\n          disabled={isConnecting}\n        >\n          <i className={buildClassName('icon', !hasVideo ? 'icon-video-stop' : 'icon-video')} aria-hidden />\n        </Button>\n\n        <Button\n          round\n          size=\"default\"\n          ripple\n          className={buildClassName(\n            styles.actionButton,\n            !hasAudioStream && styles.muted,\n            canRequestToSpeak && styles.canRequestToSpeak,\n          )}\n          onClick={handleToggleGroupCallPresentation}\n          ariaLabel={lang(hasPresentation ? 'lng_group_call_screen_share_stop' : 'lng_group_call_tooltip_screen')}\n          disabled={isConnecting || !IS_SCREENSHARE_SUPPORTED}\n        >\n          <i\n            className={buildClassName('icon', !hasPresentation ? 'icon-share-screen-stop' : 'icon-share-screen')}\n            aria-hidden\n          />\n        </Button>\n\n        <MicrophoneButton className={styles.actionButton} />\n\n        <Button\n          round\n          size=\"default\"\n          ripple\n          className={buildClassName(\n            styles.actionButton,\n            !hasAudioStream && styles.muted,\n            canRequestToSpeak && styles.canRequestToSpeak,\n          )}\n          ariaLabel={lang('lng_group_call_settings')}\n          disabled\n        >\n          <i className=\"icon icon-settings-filled\" aria-hidden />\n        </Button>\n\n        <Button\n          round\n          size=\"default\"\n          ripple\n          className={buildClassName(\n            styles.actionButton,\n            styles.destructive,\n          )}\n          onClick={handleLeaveGroupCall}\n          ariaLabel={lang('lng_group_call_leave')}\n        >\n          <i className=\"icon icon-close\" aria-hidden />\n        </Button>\n      </div>\n\n      <Modal\n        isOpen={isConfirmLeaveModalOpen}\n        onClose={handleCloseConfirmLeaveModal}\n        className=\"error\"\n        title={lang(isEndGroupCallModal ? 'VoipGroupEndAlertTitle' : 'VoipGroupLeaveAlertTitle')}\n      >\n        <p>{lang(isEndGroupCallModal ? 'VoipGroupEndAlertText' : 'VoipGroupLeaveAlertText')}</p>\n        {!isEndGroupCallModal && (\n          <Checkbox\n            label={lang('VoipGroupEndChat')}\n            checked={shouldEndGroupCall}\n            onCheck={setShouldEndGroupCall}\n          />\n        )}\n        <div className=\"dialog-buttons\">\n          <Button isText className=\"confirm-dialog-button\" onClick={handleLeaveGroupCall}>\n            {lang(isEndGroupCallModal ? 'VoipGroupEnd' : 'VoipGroupLeave')}\n          </Button>\n          <Button isText className=\"confirm-dialog-button\" onClick={handleCloseConfirmLeaveModal}>\n            {lang('Cancel')}\n          </Button>\n        </div>\n      </Modal>\n    </Modal>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { groupCallId }): StateProps => {\n    const {\n      connectionState, title, participants, participantsCount, chatId,\n    } = selectGroupCall(global, groupCallId)! || {};\n\n    const chat = chatId ? selectChat(global, chatId) : undefined;\n\n    return {\n      connectionState,\n      title: title || chat?.title,\n      participantsCount,\n      meParticipant: selectGroupCallParticipant(global, groupCallId, global.currentUserId!),\n      isCallPanelVisible: Boolean(selectTabState(global).isCallPanelVisible),\n      isAdmin: selectIsAdminInActiveGroupCall(global),\n      participants,\n      canInvite: selectCanInviteToActiveGroupCall(global),\n    };\n  },\n)(GroupCall));\n","import type { RefObject } from 'react';\nimport {\n  useEffect, useMemo, useState,\n} from '../../../../lib/teact/teact';\nimport useResizeObserver from '../../../../hooks/useResizeObserver';\nimport usePrevious from '../../../../hooks/usePrevious';\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\nconst PADDING_HORIZONTAL = 10;\nconst PADDING_VERTICAL = 8;\nconst PREFERRED_PANEL_VIDEO_HEIGHT = 240;\n\nexport type VideoLayout = {\n  participantId: string;\n  type: 'video' | 'screen';\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  shouldRemount?: boolean;\n  isRemounted?: boolean;\n  noAnimate?: boolean;\n  isRemoved?: boolean;\n  orderKey: number;\n};\n\nexport type VideoParticipant = {\n  id: string;\n  type: 'video' | 'screen';\n};\n\nexport default function useGroupCallVideoLayout({\n  primaryContainerRef,\n  secondaryContainerRef,\n  videoParticipants,\n  isLandscapeLayout,\n  pinnedVideo,\n}: {\n  primaryContainerRef: RefObject<HTMLDivElement>;\n  secondaryContainerRef: RefObject<HTMLDivElement>;\n  videoParticipants: VideoParticipant[];\n  isLandscapeLayout: boolean;\n  pinnedVideo: VideoParticipant | undefined;\n}) {\n  const [videoLayout, setVideoLayout] = useState<VideoLayout[]>([]);\n  const [panelOffset, setPanelOffset] = useState(0);\n  const videosCount = videoParticipants.length;\n  const prevVideosCount = usePrevious(videosCount);\n  const prevVideoParticipants = usePrevious(videoParticipants);\n  const removedVideoParticipants = useMemo(() => {\n    return prevVideoParticipants?.filter(\n      ({ id, type }) => !videoParticipants.some((p) => p.id === id && p.type === type),\n    );\n  }, [prevVideoParticipants, videoParticipants]);\n\n  const recalculateLayout = useLastCallback(() => {\n    const primaryContainer = primaryContainerRef.current;\n    const secondaryContainer = secondaryContainerRef.current;\n    if (!secondaryContainer) return;\n\n    const removed = prevVideosCount !== undefined && prevVideosCount > videosCount\n      ? prevVideosCount - videosCount : 0;\n\n    const {\n      x: secondaryInitialX,\n      y: secondaryInitialY,\n      width: secondaryContainerWidth,\n    } = secondaryContainer.getBoundingClientRect();\n\n    const layout: VideoLayout[] = [];\n    if (pinnedVideo !== undefined || !primaryContainer || !isLandscapeLayout) {\n      const isRemounted = true;\n      let skip = false;\n      let pinnedSkipIndex = 0;\n      let pinnedPush: VideoLayout | undefined;\n      let participants = videoParticipants;\n      if (pinnedVideo && primaryContainer && isLandscapeLayout) {\n        pinnedSkipIndex = participants\n          .findIndex(({ id, type }) => id === pinnedVideo.id && type === pinnedVideo.type);\n        if (pinnedSkipIndex !== -1) {\n          const {\n            x: initialX,\n            y: initialY,\n            width: containerWidth,\n            height: containerHeight,\n          } = primaryContainer.getBoundingClientRect();\n\n          const { id: participantId, type } = pinnedVideo;\n\n          pinnedPush = {\n            x: initialX,\n            y: initialY,\n            width: containerWidth,\n            height: containerHeight,\n            participantId,\n            type,\n            orderKey: pinnedSkipIndex,\n          };\n          skip = true;\n          participants = participants\n            .filter(({ id, type: videoType }) => id !== participantId || videoType !== pinnedVideo.type);\n        }\n      }\n\n      const secondaryVideosCounts = skip ? videosCount - 1 : videosCount;\n\n      const isFirstBig = secondaryVideosCounts % 2 === 1;\n      const columns = 2;\n      const rows = Math.ceil(secondaryVideosCounts / columns);\n      const smallWidth = (secondaryContainerWidth - (columns - 1) * PADDING_HORIZONTAL) / columns;\n      const heightTotal = Math.max(0, isFirstBig\n        ? (PREFERRED_PANEL_VIDEO_HEIGHT + (rows - 1) * smallWidth + (rows - 1) * PADDING_VERTICAL)\n        : rows * smallWidth + (rows - 1) * PADDING_VERTICAL);\n\n      for (let i = 0; i < secondaryVideosCounts; i++) {\n        const isBig = isFirstBig && i === 0;\n        const width = isBig ? secondaryContainerWidth : smallWidth;\n        const height = isBig ? PREFERRED_PANEL_VIDEO_HEIGHT : smallWidth;\n\n        const realIndex = isFirstBig && i !== 0 ? i + 1 : i;\n\n        const x = (isRemounted ? 0 : secondaryInitialX) + (realIndex % columns) * (width + PADDING_HORIZONTAL);\n        const y = (isRemounted ? 0 : secondaryInitialY) + (isFirstBig && i !== 0 ? (\n          PREFERRED_PANEL_VIDEO_HEIGHT + PADDING_VERTICAL\n          + (Math.floor(realIndex / columns) - 1) * (height + PADDING_VERTICAL)\n        ) : (\n          Math.floor(realIndex / columns) * (height + PADDING_VERTICAL)\n        ));\n        layout.push({\n          x,\n          y,\n          width,\n          height,\n          shouldRemount: !isRemounted,\n          isRemounted,\n          noAnimate: true,\n          participantId: participants[i].id,\n          type: participants[i].type,\n          orderKey: i >= pinnedSkipIndex ? i + 1 : i,\n        });\n      }\n\n      if (pinnedPush) {\n        layout.splice(pinnedSkipIndex, 0, pinnedPush);\n      }\n\n      if (removedVideoParticipants) {\n        for (let i = 0; i < removed; i++) {\n          layout.push({\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            isRemounted,\n            isRemoved: true,\n            participantId: removedVideoParticipants[i].id,\n            type: removedVideoParticipants[i].type,\n            orderKey: i + videosCount,\n          });\n        }\n      }\n\n      setPanelOffset(heightTotal);\n      setVideoLayout(layout);\n      return;\n    }\n\n    const {\n      x: initialX,\n      y: initialY,\n      width: containerWidth,\n      height: containerHeight,\n    } = primaryContainer.getBoundingClientRect();\n\n    const columns = calculateColumnsCount(videosCount);\n    const rows = Math.ceil(videosCount / columns);\n    const totalGridSize = rows * columns;\n    const shouldFillLastRow = totalGridSize > videosCount;\n    const width = (containerWidth - (columns - 1) * PADDING_HORIZONTAL) / columns;\n    const height = (containerHeight - (rows - 1) * PADDING_VERTICAL) / rows;\n\n    const lastRowWidth = width * (videosCount % columns);\n    for (let i = 0; i < videosCount; i++) {\n      const row = Math.floor(i / columns);\n      const shouldCenter = shouldFillLastRow && row === rows - 1;\n      const x = initialX + (i % columns) * (width + PADDING_HORIZONTAL)\n        + (shouldCenter ? (containerWidth - lastRowWidth) / 2 : 0);\n      const y = initialY + Math.floor(i / columns) * (height + PADDING_VERTICAL);\n      layout.push({\n        x,\n        y,\n        width,\n        height,\n        participantId: videoParticipants[i].id,\n        type: videoParticipants[i].type,\n        orderKey: i,\n      });\n    }\n\n    if (removedVideoParticipants) {\n      for (let i = 0; i < removed; i++) {\n        layout.push({\n          x: 0,\n          y: 0,\n          width: 0,\n          height: 0,\n          isRemoved: true,\n          participantId: removedVideoParticipants[i].id,\n          type: removedVideoParticipants[i].type,\n          orderKey: i + videosCount,\n        });\n      }\n    }\n\n    setPanelOffset(0);\n    setVideoLayout(layout);\n  });\n\n  useEffect(recalculateLayout, [\n    recalculateLayout, videoParticipants, isLandscapeLayout, pinnedVideo,\n  ]);\n\n  useResizeObserver(primaryContainerRef, recalculateLayout, !primaryContainerRef.current);\n  useResizeObserver(secondaryContainerRef, recalculateLayout, !secondaryContainerRef.current);\n\n  return {\n    videoLayout, panelOffset,\n  };\n}\n\nfunction calculateColumnsCount(videosCount: number) {\n  if (videosCount >= 25) {\n    return 5;\n  } else if (videosCount >= 13) {\n    return 4;\n  } else if (videosCount >= 7) {\n    return 3;\n  } else if (videosCount >= 3) {\n    return 2;\n  } else {\n    return 1;\n  }\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useEffect } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiGroupCall, ApiUser } from '../../api/types';\n\nimport { selectActiveGroupCall, selectPhoneCallUser } from '../../global/selectors/calls';\nimport { selectTabState } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport './ActiveCallHeader.scss';\n\ntype StateProps = {\n  isCallPanelVisible?: boolean;\n  groupCall?: ApiGroupCall;\n  phoneCallUser?: ApiUser;\n};\n\nconst ActiveCallHeader: FC<StateProps> = ({\n  groupCall,\n  phoneCallUser,\n  isCallPanelVisible,\n}) => {\n  const { toggleGroupCallPanel } = getActions();\n\n  const lang = useLang();\n\n  useEffect(() => {\n    document.body.classList.toggle('has-call-header', Boolean(isCallPanelVisible));\n    window.electron?.setTrafficLightPosition(isCallPanelVisible ? 'lowered' : 'standard');\n\n    return () => {\n      document.body.classList.toggle('has-call-header', false);\n      window.electron?.setTrafficLightPosition('standard');\n    };\n  }, [isCallPanelVisible]);\n\n  function handleToggleGroupCallPanel() {\n    toggleGroupCallPanel();\n  }\n\n  if (!groupCall && !phoneCallUser) return undefined;\n\n  return (\n    <div\n      className={buildClassName(\n        'ActiveCallHeader',\n        isCallPanelVisible && 'open',\n      )}\n      onClick={handleToggleGroupCallPanel}\n    >\n      <span className=\"title\">{phoneCallUser?.firstName || groupCall?.title || lang('VoipGroupVoiceChat')}</span>\n    </div>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    const tabState = selectTabState(global);\n    return {\n      groupCall: tabState.isMasterTab ? selectActiveGroupCall(global) : undefined,\n      isCallPanelVisible: tabState.isCallPanelVisible,\n      phoneCallUser: tabState.isMasterTab ? selectPhoneCallUser(global) : undefined,\n    };\n  },\n)(ActiveCallHeader));\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"eWbOLx__FZXR1sqKEJek\",\"button\":\"XKOJvKiD4DsRfJLLhnw2\",\"active\":\"qvAVe7qcyaEvRQQ1StFI\",\"button-text\":\"wnAniFJmQ7ocVtjRHNey\",\"buttonText\":\"wnAniFJmQ7ocVtjRHNey\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\n\nimport buildClassName from '../../../util/buildClassName';\n\nimport Button from '../../ui/Button';\n\nimport styles from './PhoneCallButton.module.scss';\n\ntype OwnProps = {\n  onClick: VoidFunction;\n  label: string;\n  icon?: string;\n  iconClassName?: string;\n  customIcon?: React.ReactNode;\n  className?: string;\n  isDisabled?: boolean;\n  isActive?: boolean;\n};\n\nconst PhoneCallButton: FC<OwnProps> = ({\n  onClick,\n  label,\n  customIcon,\n  icon,\n  iconClassName,\n  className,\n  isDisabled,\n  isActive,\n}) => {\n  return (\n    <div className={styles.root}>\n      <Button\n        round\n        className={buildClassName(className, styles.button, isActive && styles.active)}\n        onClick={onClick}\n        disabled={isDisabled}\n      >\n        {customIcon || <i className={buildClassName(iconClassName, 'icon', `icon-${icon}`)} />}\n      </Button>\n      <div className={styles.buttonText}>{label}</div>\n    </div>\n  );\n};\n\nexport default memo(PhoneCallButton);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"AddQYAOZJv2f7U7qIfC3\",\"blurred\":\"anFtHj7Wvsv4M_2I2EFF\",\"single-column\":\"Oi7aFYBAbl4bYichdt52\",\"singleColumn\":\"Oi7aFYBAbl4bYichdt52\",\"header\":\"_iK8HccGNSmmo2wL7tMs\",\"close-button\":\"U66J7V5JKTCiktgwYpcC\",\"closeButton\":\"U66J7V5JKTCiktgwYpcC\",\"emojis-backdrop\":\"IekzemHkkO4bfrWHmxlv\",\"emojisBackdrop\":\"IekzemHkkO4bfrWHmxlv\",\"open\":\"hiNHKiq2owo1FvdT9a5g\",\"emojis\":\"BjOb1fDymE5GCiJ4g6YN\",\"emoji-tooltip\":\"Ci9ie86NFinrXvowDx23\",\"emojiTooltip\":\"Ci9ie86NFinrXvowDx23\",\"user-info\":\"eiM2IbZjKKAwrfNtXtAy\",\"userInfo\":\"eiM2IbZjKKAwrfNtXtAy\",\"buttons\":\"AtK8DjRToL8Uk7ZAY25p\",\"leave\":\"uI2mkCTKDcqYPu64xKOk\",\"accept\":\"PC2FeM0OEDDW0TVFGMkk\",\"accept-icon\":\"hBxp1Loj3vj4DtnculDA\",\"acceptIcon\":\"hBxp1Loj3vj4DtnculDA\",\"main-video\":\"lXMZESnc4CBKQbvV7qkL\",\"mainVideo\":\"lXMZESnc4CBKQbvV7qkL\",\"second-video\":\"cnQvI_xwAbO0EEwRcLsg\",\"secondVideo\":\"cnQvI_xwAbO0EEwRcLsg\",\"visible\":\"XaD79h6hSiEi0ypkn5OK\",\"fullscreen\":\"NlF9_Kb2le_3B712PZnO\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useMemo, useRef,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\nimport '../../../global/actions/calls';\n\nimport type { ApiPhoneCall, ApiUser } from '../../../api/types';\n\nimport {\n  IS_ANDROID,\n  IS_IOS,\n  IS_REQUEST_FULLSCREEN_SUPPORTED,\n} from '../../../util/windowEnvironment';\nimport { LOCAL_TGS_URLS } from '../../common/helpers/animatedAssets';\nimport { selectTabState } from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport { selectPhoneCallUser } from '../../../global/selectors/calls';\nimport useLang from '../../../hooks/useLang';\nimport renderText from '../../common/helpers/renderText';\nimport useFlag from '../../../hooks/useFlag';\nimport { formatMediaDuration } from '../../../util/dateFormat';\nimport {\n  getStreams, IS_SCREENSHARE_SUPPORTED, switchCameraInputP2p, toggleStreamP2p,\n} from '../../../lib/secret-sauce';\nimport useInterval from '../../../hooks/useInterval';\nimport useForceUpdate from '../../../hooks/useForceUpdate';\nimport useAppLayout from '../../../hooks/useAppLayout';\n\nimport Modal from '../../ui/Modal';\nimport Avatar from '../../common/Avatar';\nimport Button from '../../ui/Button';\nimport PhoneCallButton from './PhoneCallButton';\nimport AnimatedIcon from '../../common/AnimatedIcon';\n\nimport styles from './PhoneCall.module.scss';\n\ntype StateProps = {\n  user?: ApiUser;\n  phoneCall?: ApiPhoneCall;\n  isOutgoing: boolean;\n  isCallPanelVisible?: boolean;\n};\n\nconst PhoneCall: FC<StateProps> = ({\n  user,\n  isOutgoing,\n  phoneCall,\n  isCallPanelVisible,\n}) => {\n  const lang = useLang();\n  const {\n    hangUp, requestMasterAndAcceptCall, playGroupCallSound, toggleGroupCallPanel, connectToActivePhoneCall,\n  } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const [isFullscreen, openFullscreen, closeFullscreen] = useFlag();\n  const { isMobile } = useAppLayout();\n\n  const toggleFullscreen = useCallback(() => {\n    if (isFullscreen) {\n      closeFullscreen();\n    } else {\n      openFullscreen();\n    }\n  }, [closeFullscreen, isFullscreen, openFullscreen]);\n\n  const handleToggleFullscreen = useCallback(() => {\n    if (!containerRef.current) return;\n\n    if (isFullscreen) {\n      document.exitFullscreen().then(closeFullscreen);\n    } else {\n      containerRef.current.requestFullscreen().then(openFullscreen);\n    }\n  }, [closeFullscreen, isFullscreen, openFullscreen]);\n\n  useEffect(() => {\n    if (!IS_REQUEST_FULLSCREEN_SUPPORTED) return undefined;\n    const container = containerRef.current;\n    if (!container) return undefined;\n\n    container.addEventListener('fullscreenchange', toggleFullscreen);\n\n    return () => {\n      container.removeEventListener('fullscreenchange', toggleFullscreen);\n    };\n  }, [toggleFullscreen]);\n\n  const handleClose = useCallback(() => {\n    toggleGroupCallPanel();\n    if (isFullscreen) {\n      closeFullscreen();\n    }\n  }, [closeFullscreen, isFullscreen, toggleGroupCallPanel]);\n\n  const isDiscarded = phoneCall?.state === 'discarded';\n  const isBusy = phoneCall?.reason === 'busy';\n\n  const isIncomingRequested = phoneCall?.state === 'requested' && !isOutgoing;\n  const isOutgoingRequested = (phoneCall?.state === 'requested' || phoneCall?.state === 'waiting') && isOutgoing;\n  const isActive = phoneCall?.state === 'active';\n  const isConnected = phoneCall?.isConnected;\n\n  const [isHangingUp, startHangingUp, stopHangingUp] = useFlag();\n  const handleHangUp = useCallback(() => {\n    startHangingUp();\n    hangUp();\n  }, [hangUp, startHangingUp]);\n\n  useEffect(() => {\n    if (isHangingUp) {\n      playGroupCallSound({ sound: 'end' });\n    } else if (isIncomingRequested) {\n      playGroupCallSound({ sound: 'incoming' });\n    } else if (isBusy) {\n      playGroupCallSound({ sound: 'busy' });\n    } else if (isDiscarded) {\n      playGroupCallSound({ sound: 'end' });\n    } else if (isOutgoingRequested) {\n      playGroupCallSound({ sound: 'ringing' });\n    } else if (isConnected) {\n      playGroupCallSound({ sound: 'connect' });\n    }\n  }, [isBusy, isDiscarded, isIncomingRequested, isOutgoingRequested, isConnected, playGroupCallSound, isHangingUp]);\n\n  useEffect(() => {\n    if (phoneCall?.id) {\n      stopHangingUp();\n    } else {\n      connectToActivePhoneCall();\n    }\n  }, [connectToActivePhoneCall, phoneCall?.id, stopHangingUp]);\n\n  const forceUpdate = useForceUpdate();\n\n  useInterval(() => {\n    forceUpdate();\n  }, isConnected ? 1000 : undefined);\n\n  const callStatus = useMemo(() => {\n    const state = phoneCall?.state;\n    if (isHangingUp) {\n      return lang('lng_call_status_hanging');\n    }\n    if (isBusy) return 'busy';\n    if (state === 'requesting') {\n      return lang('lng_call_status_requesting');\n    } else if (state === 'requested') {\n      return isOutgoing ? lang('lng_call_status_ringing') : lang('lng_call_status_incoming');\n    } else if (state === 'waiting') {\n      return lang('lng_call_status_waiting');\n    } else if (state === 'active' && isConnected) {\n      return undefined;\n    } else {\n      return lang('lng_call_status_exchanging');\n    }\n  }, [isBusy, isConnected, isHangingUp, isOutgoing, lang, phoneCall?.state]);\n\n  const hasVideo = phoneCall?.videoState === 'active';\n  const hasPresentation = phoneCall?.screencastState === 'active';\n\n  const streams = getStreams();\n  const hasOwnAudio = streams?.ownAudio?.getTracks()[0].enabled;\n  const hasOwnPresentation = streams?.ownPresentation?.getTracks()[0].enabled;\n  const hasOwnVideo = streams?.ownVideo?.getTracks()[0].enabled;\n\n  const [isHidingPresentation, startHidingPresentation, stopHidingPresentation] = useFlag();\n  const [isHidingVideo, startHidingVideo, stopHidingVideo] = useFlag();\n\n  const handleTogglePresentation = useCallback(() => {\n    if (hasOwnPresentation) {\n      startHidingPresentation();\n    }\n    if (hasOwnVideo) {\n      startHidingVideo();\n    }\n    setTimeout(async () => {\n      await toggleStreamP2p('presentation');\n      stopHidingPresentation();\n      stopHidingVideo();\n    }, 250);\n  }, [\n    hasOwnPresentation, hasOwnVideo, startHidingPresentation, startHidingVideo, stopHidingPresentation, stopHidingVideo,\n  ]);\n\n  const handleToggleVideo = useCallback(() => {\n    if (hasOwnVideo) {\n      startHidingVideo();\n    }\n    if (hasOwnPresentation) {\n      startHidingPresentation();\n    }\n    setTimeout(async () => {\n      await toggleStreamP2p('video');\n      stopHidingPresentation();\n      stopHidingVideo();\n    }, 250);\n  }, [\n    hasOwnPresentation, hasOwnVideo, startHidingPresentation, startHidingVideo, stopHidingPresentation, stopHidingVideo,\n  ]);\n\n  const handleToggleAudio = useCallback(() => {\n    void toggleStreamP2p('audio');\n  }, []);\n\n  const [isEmojiOpen, openEmoji, closeEmoji] = useFlag();\n\n  const [isFlipping, startFlipping, stopFlipping] = useFlag();\n\n  const handleFlipCamera = useCallback(() => {\n    startFlipping();\n    switchCameraInputP2p();\n    setTimeout(stopFlipping, 250);\n  }, [startFlipping, stopFlipping]);\n\n  const timeElapsed = phoneCall?.startDate && (Number(new Date()) / 1000 - phoneCall.startDate);\n\n  useEffect(() => {\n    if (phoneCall?.state === 'discarded') {\n      setTimeout(hangUp, 250);\n    }\n  }, [hangUp, phoneCall?.reason, phoneCall?.state]);\n\n  return (\n    <Modal\n      isOpen={phoneCall && phoneCall?.state !== 'discarded' && !isCallPanelVisible}\n      onClose={handleClose}\n      className={buildClassName(\n        styles.root,\n        isMobile && styles.singleColumn,\n      )}\n      dialogRef={containerRef}\n    >\n      <Avatar\n        peer={user}\n        size=\"jumbo\"\n        className={hasVideo || hasPresentation ? styles.blurred : ''}\n      />\n      {phoneCall?.screencastState === 'active' && streams?.presentation\n        && <video className={styles.mainVideo} muted autoPlay playsInline srcObject={streams.presentation} />}\n      {phoneCall?.videoState === 'active' && streams?.video\n        && <video className={styles.mainVideo} muted autoPlay playsInline srcObject={streams.video} />}\n      <video\n        className={buildClassName(\n          styles.secondVideo,\n          !isHidingPresentation && hasOwnPresentation && styles.visible,\n          isFullscreen && styles.fullscreen,\n        )}\n        muted\n        autoPlay\n        playsInline\n        srcObject={streams?.ownPresentation}\n      />\n      <video\n        className={buildClassName(\n          styles.secondVideo,\n          !isHidingVideo && hasOwnVideo && styles.visible,\n          isFullscreen && styles.fullscreen,\n        )}\n        muted\n        autoPlay\n        playsInline\n        srcObject={streams?.ownVideo}\n      />\n      <div className={styles.header}>\n        {IS_REQUEST_FULLSCREEN_SUPPORTED && (\n          <Button\n            round\n            size=\"smaller\"\n            color=\"translucent\"\n            onClick={handleToggleFullscreen}\n            ariaLabel={lang(isFullscreen ? 'AccExitFullscreen' : 'AccSwitchToFullscreen')}\n          >\n            <i className={buildClassName('icon', isFullscreen ? 'icon-smallscreen' : 'icon-fullscreen')} />\n          </Button>\n        )}\n\n        <Button\n          round\n          size=\"smaller\"\n          color=\"translucent\"\n          onClick={handleClose}\n          className={styles.closeButton}\n        >\n          <i className=\"icon icon-close\" />\n        </Button>\n      </div>\n      <div\n        className={buildClassName(styles.emojisBackdrop, isEmojiOpen && styles.open)}\n        onClick={!isEmojiOpen ? openEmoji : closeEmoji}\n      >\n        <div className={buildClassName(styles.emojis, isEmojiOpen && styles.open)}>\n          {phoneCall?.isConnected && phoneCall?.emojis && renderText(phoneCall.emojis, ['emoji'])}\n        </div>\n        <div className={buildClassName(styles.emojiTooltip, isEmojiOpen && styles.open)}>\n          {lang('CallEmojiKeyTooltip', user?.firstName).replace('%%', '%')}\n        </div>\n      </div>\n      <div className={styles.userInfo}>\n        <h1>{user?.firstName}</h1>\n        <span className={styles.status}>{callStatus || formatMediaDuration(timeElapsed || 0)}</span>\n      </div>\n      <div className={styles.buttons}>\n        <PhoneCallButton\n          onClick={handleToggleAudio}\n          icon=\"microphone\"\n          isDisabled={!isActive}\n          isActive={hasOwnAudio}\n          label={lang(hasOwnAudio ? 'lng_call_mute_audio' : 'lng_call_unmute_audio')}\n        />\n        <PhoneCallButton\n          onClick={handleToggleVideo}\n          icon=\"video\"\n          isDisabled={!isActive}\n          isActive={hasOwnVideo}\n          label={lang(hasOwnVideo ? 'lng_call_stop_video' : 'lng_call_start_video')}\n        />\n        {hasOwnVideo && (IS_ANDROID || IS_IOS) && (\n          <PhoneCallButton\n            onClick={handleFlipCamera}\n            customIcon={(\n              <AnimatedIcon\n                tgsUrl={LOCAL_TGS_URLS.CameraFlip}\n                playSegment={!isFlipping ? [0, 1] : [0, 10]}\n                size={32}\n              />\n            )}\n            isDisabled={!isActive}\n            label={lang('VoipFlip')}\n          />\n        )}\n        {IS_SCREENSHARE_SUPPORTED && (\n          <PhoneCallButton\n            onClick={handleTogglePresentation}\n            icon=\"share-screen\"\n            isDisabled={!isActive}\n            isActive={hasOwnPresentation}\n            label={lang('lng_call_screencast')}\n          />\n        )}\n        {isIncomingRequested && (\n          <PhoneCallButton\n            onClick={requestMasterAndAcceptCall}\n            icon=\"phone-discard\"\n            isDisabled={isDiscarded}\n            label={lang('lng_call_accept')}\n            className={styles.accept}\n            iconClassName={styles.acceptIcon}\n          />\n        )}\n        <PhoneCallButton\n          onClick={handleHangUp}\n          icon=\"phone-discard\"\n          isDisabled={isDiscarded}\n          label={lang(isIncomingRequested ? 'lng_call_decline' : 'lng_call_end_call')}\n          className={styles.leave}\n        />\n      </div>\n    </Modal>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    const { phoneCall, currentUserId } = global;\n    const { isCallPanelVisible, isMasterTab } = selectTabState(global);\n    const user = selectPhoneCallUser(global);\n\n    return {\n      isCallPanelVisible: Boolean(isCallPanelVisible),\n      user,\n      isOutgoing: phoneCall?.adminId === currentUserId,\n      phoneCall: isMasterTab ? phoneCall : undefined,\n    };\n  },\n)(PhoneCall));\n","// extracted by mini-css-extract-plugin\nexport default {\"stars\":\"wLqZtZzJMOmPkr1Z7kT5\",\"star\":\"OLQPS_OeztNYIaL15tdz\",\"isFilled\":\"o_nOyYqj5URif5S86StK\",\"comment\":\"ZToDNX6q1Yhf4aDPyuJF\",\"visible\":\"HdCq8jVctaJoit7bdgZd\"};","import React, {\n  memo, useRef, useState, useCallback,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { FC } from '../../../lib/teact/teact';\n\nimport useLang from '../../../hooks/useLang';\nimport buildClassName from '../../../util/buildClassName';\n\nimport Modal from '../../ui/Modal';\nimport Button from '../../ui/Button';\nimport InputText from '../../ui/InputText';\n\nimport styles from './RatePhoneCallModal.module.scss';\n\nexport type OwnProps = {\n  isOpen?: boolean;\n};\n\nconst RatePhoneCallModal: FC<OwnProps> = ({\n  isOpen,\n}) => {\n  const { closeCallRatingModal, setCallRating } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const lang = useLang();\n  const [rating, setRating] = useState<number | undefined>();\n\n  const handleSend = useCallback(() => {\n    if (!rating) {\n      closeCallRatingModal();\n      return;\n    }\n    setCallRating({\n      rating: rating + 1,\n      comment: inputRef.current?.value || '',\n    });\n  }, [closeCallRatingModal, rating, setCallRating]);\n\n  function handleClickStar(index: number) {\n    return () => setRating(rating === index ? undefined : index);\n  }\n\n  const handleCancelClick = useCallback(() => {\n    closeCallRatingModal();\n  }, [closeCallRatingModal]);\n\n  return (\n    <Modal title={lang('lng_call_rate_label')} className=\"narrow\" onClose={closeCallRatingModal} isOpen={isOpen}>\n      <div className={styles.stars}>\n        {new Array(5).fill(undefined).map((_, i) => {\n          const isFilled = rating !== undefined && rating >= i;\n          return (\n            <i\n              className={buildClassName(\n                'icon',\n                isFilled ? 'icon-favorite-filled' : 'icon-favorite',\n                isFilled && styles.isFilled,\n                styles.star,\n              )}\n              onClick={handleClickStar(i)}\n            />\n          );\n        })}\n      </div>\n      <InputText\n        ref={inputRef}\n        placeholder={lang('lng_call_rate_comment')}\n        className={buildClassName(styles.comment, rating !== 4 && rating !== undefined && styles.visible)}\n      />\n\n      <div className=\"dialog-buttons mt-2\">\n        <Button className=\"confirm-dialog-button\" isText onClick={handleSend}>\n          {lang('Send')}\n        </Button>\n        <Button className=\"confirm-dialog-button\" isText onClick={handleCancelClick}>{lang('Cancel')}</Button>\n      </div>\n    </Modal>\n  );\n};\n\nexport default memo(RatePhoneCallModal);\n","import { IS_IOS, IS_SAFARI } from '../util/windowEnvironment';\nimport { initializeSoundsForSafari } from '../global/actions/ui/calls';\n\nexport { default as GroupCall } from '../components/calls/group/GroupCall';\nexport { default as ActiveCallHeader } from '../components/calls/ActiveCallHeader';\nexport { default as PhoneCall } from '../components/calls/phone/PhoneCall';\nexport { default as RatePhoneCallModal } from '../components/calls/phone/RatePhoneCallModal';\n\nif (IS_SAFARI || IS_IOS) {\n  document.addEventListener('click', initializeSoundsForSafari, { once: true });\n}\n"],"names":["toTelegramSource","source","fromTelegramSource","getAmplitude","array","scale","arguments","length","undefined","total","i","rms","Math","sqrt","min","p2pPayloadTypeToConference","p","id","name","feedbackTypes","clockrate","parameters","channels","THRESHOLD","IS_SCREENSHARE_SUPPORTED","navigator","mediaDevices","IS_ECHO_CANCELLATION_SUPPORTED","getSupportedConstraints","echoCancellation","IS_NOISE_SUPPRESSION_SUPPORTED","noiseSuppression","sessionDescription","isP2p","sdp","Error","sections","split","map","s","reduce","acc","el","match","hasOwnProperty","filter","Boolean","lookup","prefix","sectionName","find","line","startsWith","substr","Object","values","section","parseExtmaps","l","uri","Number","parsePayloadTypes","payloads","data","fbParams","type","subtype","d","q","value","some","z","payload","assign","f","keys","rawSource","sourceAudio","rawSourceVideo","rawSourceScreencast","hash","fingerprint","setup","console","log","ufrag","pwd","fingerprints","ssrc","semantics","sources","slice","audioExtmap","videoExtmap","screencastExtmap","audioPayloadTypes","videoPayloadTypes","screencastPayloadTypes","conference","isAnswer","isPresentation","lines","add","push","sessionId","ssrcs","audioExtensions","videoExtensions","transport","candidates","mid","join","addCandidate","c","sdpString","str","foundation","component","protocol","priority","ip","port","generation","addTransport","forEach","addPayloadType","payloadType","parametersString","key","fbParam","addSsrcEntry","entry","payloadTypes","isVideo","isMain","_ref","isRemoved","sourceGroups","sourceGroup","ssrcTelegram","endpoint","silence","ctx","oscillator","createOscillator","dst","connect","createMediaStreamDestination","start","MediaStream","stream","getAudioTracks","enabled","black","width","height","canvas","document","createElement","getContext","fillRect","captureStream","getVideoTracks","state","leavePresentation","isFromToggle","screenshareDataChannel","close","screenshareConnection","onUpdate","getUserStreams","userId","streams","setVolume","volume","participantFunctions","isStreamEnabled","streamType","myId","getTracks","updateGroupCallStreams","hasAudioStream","hasVideoStream","hasPresentationStream","amplitude","speaking","async","getUserStream","facing","audioStream","getDisplayMedia","audio","video","media","getUserMedia","facingMode","vid","srcObject","deferred","Deferred","oncanplay","resolve","promise","toggleStream","connection","track","sender","getSenders","newStream","replaceTrack","audioContext","audioSource","createMediaStreamSource","analyser","audioAnalyser","createAnalyser","minDecibels","maxDecibels","smoothingTimeConstant","fftSize","getCurrentAmplitude","Uint8Array","frequencyBinCount","getByteFrequencyData","stop","disconnect","e","updateConnectionState","connectionState","leaveGroupCall","dataChannel","analyserInterval","clearInterval","analyzeAmplitudes","prevAmplitude","handleUpdateGroupCallParticipants","updatedParticipants","participants","participant","isSelf","newEndpoints","isMuted","canSelfUnmute","isLeft","isAudioLeft","isMutedByMe","isVideoLeft","isVideoJoined","isPresentationLeft","presentation","hasVideo","hasAudio","hasPresentation","lastMid","toString","updatingParticipantsQueue","buildSdp","setRemoteDescription","answer","createAnswer","setLocalDescription","newConference","answerNew","error","handleTrack","audioElement","mediaStream","kind","onended","window","AudioContext","gainNode","createGain","gain","muteNode","destination","addTrack","test","Audio","muted","remove","toggleMute","initializeConnection","RTCPeerConnection","createDataChannel","onopen","onmessage","JSON","parse","colibriClass","onerror","oniceconnectionstatechange","iceConnectionState","onconnectionstatechange","ontrack","onnegotiationneeded","offer","createOffer","offerToReceiveVideo","offerToReceiveAudio","parseSdp","audioSsrc","videoSsrc","screenshareConference","videoStream","updateStreams","mediaState","toggleStreamP2p","ownAudio","ownVideo","ownPresentation","blackVideo","blackPresentation","sendMediaState","stopPhoneCall","emitSignalingData","videoRotation","isBatteryLow","videoState","screencastState","filterVP8","mediaContent","isOutgoing","idx","findIndex","vp8PayloadType","rtxIdx","apt","sendInitialSetup","ssrcGroups","rtpExtensions","screencast","processSignalingMessage","message","gotInitialSetup","candidate","Promise","all","addIceCandidate","sdpMLineIndex","xmlns","Date","now","addActionHandler","global","actions","isFromLibrary","shouldDiscard","shouldRemove","rejoin","isPageUnload","tabId","getCurrentTabId","groupCall","selectActiveGroupCall","updateActiveGroupCall","participantsCount","groupCalls","activeGroupCallId","setGlobal","callApi","call","getGlobal","removeGroupCall","removeGroupCallAudioElement","toggleGroupCallPanel","force","afterHangUp","requestMasterAndJoinGroupCall","user","selectUser","currentUserId","videoStopped","raiseHand","participantId","floor","GROUP_CALL_VOLUME_MULTIPLIER","params","startSharingScreen","presentationPaused","showNotification","getGroupCallAudioElement","getGroupCallAudioContext","safePlay","setInterval","joinGroupCall","apiUpdate","result","inviteHash","loadMoreGroupCallParticipants","chatId","chat","selectChat","loadFullChat","phoneCall","selectPhoneCallUser","dhConfig","gAHash","addUsers","buildCollectionByKey","users","hangUp","gB","stringify","encodedData","updateTabState","ratingPhoneCall","rating","comment","selectTabState","setTimeout","EMOJI_DATA","Uint16Array","EMOJI_OFFSETS","update","toggleGroupCallPresentation","selectGroupCallParticipant","updateGroupCallParticipant","omit","updateGroupCall","isSpeakerDisabled","groupCallId","handleUpdateGroupCallConnection","ARE_CALLS_SUPPORTED","adminId","isBusy","accessHash","connections","libraryVersions","version","langProvider","firstName","needRating","isCallPanelVisible","gA","keyFingerprint","emojis","newCall","gAOrB","shouldStartVideo","conn","iceServers","urls","isTurn","isStun","username","credentialType","credential","password","iceCandidatePoolSize","slnc","screenshare","onicecandidate","part","isRelayAddress","candidateWithoutRelatedAddress","parts","raddrIndex","indexOf","splice","rportIndex","removeRelatedAddress","play","catch","transceiver","dc","negotiated","joinPhoneCall","sendSignalingData","isP2pAllowed","isConnected","then","vibrateShort","vibrate","memo","withGlobal","meParticipant","raiseHandRating","hasRequestedToSpeak","noAudioStream","className","toggleGroupCallMute","requestToSpeak","playGroupCallSound","getActions","lang","useLang","muteMouseDownState","useRef","isRequestingToSpeak","setIsRequestingToSpeak","useState","isConnecting","shouldRaiseHand","prevShouldRaiseHand","usePrevious","useEffect","sound","playSegment","useMemo","r","random","animatedIconName","useCallback","handleMouseDownMute","current","handleMouseUpMute","React","Button","round","size","buildClassName","onMouseDown","onMouseUp","ariaLabel","disabled","AnimatedIcon","tgsUrl","LOCAL_TGS_URLS","forceOnHeavyAnimation","forceInBackground","Spinner","color","formatGroupCallVolume","GROUP_CALL_DEFAULT_VOLUME","noColor","isSpeaking","isRaiseHand","prevIsRaiseHand","prevIsMuted","microphoneColor","VoiceOutlined","nonInteractive","SPEAKER_ICON_DISABLED_SEGMENT","SPEAKER_ICON_ENABLED_SEGMENT","isAdmin","selectIsAdminInActiveGroupCall","onCloseAnimationEnd","onClose","isDropdownOpen","positionY","menuRef","positionX","style","transformOriginY","transformOriginX","setGroupCallParticipantVolume","openChat","isDeleteUserModalOpen","openDeleteUserModal","closeDeleteUserModal","useFlag","localVolume","setLocalVolume","shouldPlay","setShouldPlay","isLocalVolumeZero","speakerIconPlaySegment","handleSetLocalVolume","useLastCallback","runThrottled","ms","noFirst","deps","useThrottledCallback","cb","useRunThrottled","handleRemove","stopPropagation","handleCancelRequestToSpeak","handleMute","_participant$volume","handleOpenProfile","Menu","isOpen","ref","withPortal","max","onChange","target","Speaker","MenuItem","icon","onClick","destructive","DeleteMemberModal","_ref2","peer","isContextMenuOpen","contextMenuPosition","handleContextMenu","handleBeforeContextMenu","handleContextMenuClose","handleContextMenuHide","useContextMenuHandlers","getTriggerElement","getRootElement","closest","getMenuElement","getLayout","menuStyle","useMenuPosition","hasCustomVolume","aboutText","aboutColor","styles","subtitleRed","subtitleBlue","replace","subtitleGreen","about","ListItem","leftElement","Avatar","avatar","rightElement","OutlinedMicrophoneIcon","root","onContextMenu","multiline","ripple","FullNameTitle","withEmojiStatus","title","subtitle","subtitleText","renderText","GroupCallParticipantMenu","compareFields","a","b","compareParticipants","panelOffset","isLandscape","orderedParticipantIds","sort","handleLoadMoreGroupCallParticipants","viewportIds","getMore","useInfiniteScroll","InfiniteScroll","items","onLoadMore","GroupCallParticipant","teactOrderKey","isUser","layout","pinnedVideo","setPinned","canPin","thumbnailRef","videoRef","videoFallbackRef","x","y","noAnimate","isPinned","shouldFlipVideo","status","prevLayoutRef","prevX","prevY","prevWidth","prevHeight","currentX","currentY","currentWidth","currentHeight","isHidden","setIsHidden","actualStream","streamRef","active","handleInactive","addEventListener","removeEventListener","isLoading","setIsLoading","handleCanPlay","useInterval","requestMutation","videoWidth","videoHeight","drawImage","thumbnail","alpha","isDrawing","animate","draw","IS_CANVAS_FILTER_SUPPORTED","fastBlur","fastRaf","handleClickPin","onDoubleClick","Skeleton","autoPlay","playsInline","onCanPlay","_ref5","selectGroupCall","canInvite","selectCanInviteToActiveGroupCall","toggleGroupCallVideo","connectToActiveGroupCall","createGroupCallInviteLink","containerRef","primaryVideoContainerRef","secondaryVideoContainerRef","panelScrollTriggerRef","panelRef","isLeaving","setIsLeaving","observe","useIntersectionObserver","rootRef","throttleMs","isDisabled","hasScrolled","useIsIntersecting","isMobile","useAppLayout","isFullscreen","openFullscreen","closeFullscreen","isSidebarOpen","openSidebar","closeSidebar","isLandscapeLayout","firstPresentation","videoParticipants","_ref3","flatMap","_ref4","compact","hasVideoParticipants","groupCallTitle","membersString","isConfirmLeaveModalOpen","openConfirmLeaveModal","closeConfirmLeaveModal","isEndGroupCallModal","setIsEndGroupCallModal","shouldEndGroupCall","setShouldEndGroupCall","canRequestToSpeak","handleCloseConfirmLeaveModal","handleToggleFullscreen","handleToggleSidebar","handleToggleGroupCallPanel","handleInviteMember","handleClickVideo","handleLeaveGroupCall","handleCloseAnimationEnd","handleToggleGroupCallPresentation","canPinVideo","isLandscapeWithVideos","setPinnedVideo","videoLayout","primaryContainerRef","secondaryContainerRef","setVideoLayout","setPanelOffset","videosCount","prevVideosCount","prevVideoParticipants","removedVideoParticipants","recalculateLayout","primaryContainer","secondaryContainer","removed","secondaryInitialX","secondaryInitialY","secondaryContainerWidth","getBoundingClientRect","isRemounted","pinnedPush","skip","pinnedSkipIndex","initialX","initialY","containerWidth","containerHeight","orderKey","videoType","secondaryVideosCounts","isFirstBig","columns","rows","ceil","smallWidth","heightTotal","isBig","realIndex","PREFERRED_PANEL_VIDEO_HEIGHT","shouldRemount","calculateColumnsCount","shouldFillLastRow","lastRowWidth","row","useResizeObserver","useGroupCallVideoLayout","handleSetPinnedVideo","handleOpenFirstPresentation","Modal","fullscreen","landscape","noVideoParticipants","portrait","noSidebar","dialogRef","videos","videosHeader","headerButton","firstButton","bigger","videosHeaderLastButton","videosContent","panelWrapper","panel","panelScrollTrigger","panelHeader","scrolled","panelHeaderText","lastButton","participantVideos","GroupCallParticipantVideo","GroupCallParticipantList","FloatingActionButton","isShown","addParticipantButton","mainVideoContainer","actionButton","MicrophoneButton","Checkbox","label","checked","onCheck","isText","tabState","isMasterTab","phoneCallUser","body","classList","toggle","electron","setTrafficLightPosition","customIcon","iconClassName","isActive","requestMasterAndAcceptCall","connectToActivePhoneCall","toggleFullscreen","exitFullscreen","requestFullscreen","IS_REQUEST_FULLSCREEN_SUPPORTED","container","handleClose","isDiscarded","reason","isIncomingRequested","isOutgoingRequested","isHangingUp","startHangingUp","stopHangingUp","handleHangUp","forceUpdate","useForceUpdate","callStatus","hasOwnAudio","hasOwnPresentation","hasOwnVideo","isHidingPresentation","startHidingPresentation","stopHidingPresentation","isHidingVideo","startHidingVideo","stopHidingVideo","handleTogglePresentation","handleToggleVideo","handleToggleAudio","isEmojiOpen","openEmoji","closeEmoji","isFlipping","startFlipping","stopFlipping","handleFlipCamera","switchCameraInputP2p","timeElapsed","startDate","singleColumn","blurred","mainVideo","secondVideo","visible","header","closeButton","emojisBackdrop","open","emojiTooltip","userInfo","formatMediaDuration","buttons","PhoneCallButton","IS_ANDROID","IS_IOS","CameraFlip","accept","acceptIcon","leave","closeCallRatingModal","setCallRating","inputRef","setRating","handleSend","handleCancelClick","Array","fill","_","isFilled","index","InputText","placeholder","IS_SAFARI","initializeSoundsForSafari","once"],"sourceRoot":""}